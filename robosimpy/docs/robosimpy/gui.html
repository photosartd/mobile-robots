<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 9.0.1" />
    <title>robosimpy.gui API documentation</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2264%22%20height%3D%2264%22%20viewBox%3D%2244.5%202.5%2015%2015%22%3E%3Cpath%20d%3D%22M49.351%2021.041c-.233-.721-.546-2.408-.772-4.076-.042-.09-.067-.187-.046-.288-.166-1.347-.277-2.625-.241-3.351-1.378-1.008-2.271-2.586-2.271-4.362%200-.976.272-1.935.788-2.774.057-.094.122-.18.184-.268-.033-.167-.052-.339-.052-.516%200-1.477%201.202-2.679%202.679-2.679.791%200%201.496.352%201.987.9a6.3%206.3%200%200%201%201.001.029c.492-.564%201.207-.929%202.012-.929%201.477%200%202.679%201.202%202.679%202.679a2.65%202.65%200%200%201-.269%201.148c.383.747.595%201.572.595%202.41%200%202.311-1.507%204.29-3.635%205.107.037.699.147%202.27.423%203.294l.137.461c.156%202.136-4.612%205.166-5.199%203.215zm.127-4.919a4.78%204.78%200%200%200%20.775-.584c-.172-.115-.505-.254-.88-.378zm.331%202.302l.828-.502c-.202-.143-.576-.328-.984-.49zm.45%202.157l.701-.403c-.214-.115-.536-.249-.891-.376l.19.779zM49.13%204.141c0%20.152.123.276.276.276s.275-.124.275-.276-.123-.276-.276-.276-.275.124-.275.276zm.735-.389a1.15%201.15%200%200%201%20.314.783%201.16%201.16%200%200%201-1.162%201.162c-.457%200-.842-.27-1.032-.653-.026.117-.042.238-.042.362a1.68%201.68%200%200%200%201.679%201.679%201.68%201.68%200%200%200%201.679-1.679c0-.843-.626-1.535-1.436-1.654zm3.076%201.654a1.68%201.68%200%200%200%201.679%201.679%201.68%201.68%200%200%200%201.679-1.679c0-.037-.009-.072-.011-.109-.21.3-.541.508-.935.508a1.16%201.16%200%200%201-1.162-1.162%201.14%201.14%200%200%201%20.474-.912c-.015%200-.03-.005-.045-.005-.926.001-1.679.754-1.679%201.68zm1.861-1.265c0%20.152.123.276.276.276s.275-.124.275-.276-.123-.276-.276-.276-.275.124-.275.276zm1.823%204.823c0-.52-.103-1.035-.288-1.52-.466.394-1.06.64-1.717.64-1.144%200-2.116-.725-2.499-1.738-.383%201.012-1.355%201.738-2.499%201.738-.867%200-1.631-.421-2.121-1.062-.307.605-.478%201.267-.478%201.942%200%202.486%202.153%204.51%204.801%204.51s4.801-2.023%204.801-4.51zm-3.032%209.156l-.146-.492c-.276-1.02-.395-2.457-.444-3.268a6.11%206.11%200%200%201-1.18.115%206.01%206.01%200%200%201-2.536-.562l.006.175c.802.215%201.848.612%202.021%201.25.079.295-.021.601-.274.837l-.598.501c.667.304%201.243.698%201.311%201.179.02.144.022.507-.393.787l-.564.365c1.285.521%201.361.96%201.381%201.126.018.142.011.496-.427.746l-.854.489c.064-1.19%201.985-2.585%202.697-3.248zM49.34%209.925c0-.667%201-.667%201%200%200%20.653.818%201.205%201.787%201.205s1.787-.552%201.787-1.205c0-.667%201-.667%201%200%200%201.216-1.25%202.205-2.787%202.205s-2.787-.989-2.787-2.205zm-.887-7.633c-.093.077-.205.114-.317.114a.5.5%200%200%201-.318-.886L49.183.397a.5.5%200%200%201%20.703.068.5.5%200%200%201-.069.703zm7.661-.065c-.086%200-.173-.022-.253-.068l-1.523-.893c-.575-.337-.069-1.2.506-.863l1.523.892a.5.5%200%200%201%20.179.685c-.094.158-.261.247-.432.247z%22%20fill%3D%22%233bb300%22/%3E%3C/svg%3E"/>


<style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
<style>/*! pygments syntax highlighting */pre{line-height:125%;}td.linenos pre{color:#000000; background-color:#f0f0f0; padding-left:5px; padding-right:5px;}span.linenos{color:#000000; background-color:#f0f0f0; padding-left:5px; padding-right:5px;}td.linenos pre.special{color:#000000; background-color:#ffffc0; padding-left:5px; padding-right:5px;}span.linenos.special{color:#000000; background-color:#ffffc0; padding-left:5px; padding-right:5px;}.pdoc .hll{background-color:#ffffcc}.pdoc{background:#f8f8f8;}.pdoc .c{color:#408080; font-style:italic}.pdoc .err{border:1px solid #FF0000}.pdoc .k{color:#008000; font-weight:bold}.pdoc .o{color:#666666}.pdoc .ch{color:#408080; font-style:italic}.pdoc .cm{color:#408080; font-style:italic}.pdoc .cp{color:#BC7A00}.pdoc .cpf{color:#408080; font-style:italic}.pdoc .c1{color:#408080; font-style:italic}.pdoc .cs{color:#408080; font-style:italic}.pdoc .gd{color:#A00000}.pdoc .ge{font-style:italic}.pdoc .gr{color:#FF0000}.pdoc .gh{color:#000080; font-weight:bold}.pdoc .gi{color:#00A000}.pdoc .go{color:#888888}.pdoc .gp{color:#000080; font-weight:bold}.pdoc .gs{font-weight:bold}.pdoc .gu{color:#800080; font-weight:bold}.pdoc .gt{color:#0044DD}.pdoc .kc{color:#008000; font-weight:bold}.pdoc .kd{color:#008000; font-weight:bold}.pdoc .kn{color:#008000; font-weight:bold}.pdoc .kp{color:#008000}.pdoc .kr{color:#008000; font-weight:bold}.pdoc .kt{color:#B00040}.pdoc .m{color:#666666}.pdoc .s{color:#BA2121}.pdoc .na{color:#7D9029}.pdoc .nb{color:#008000}.pdoc .nc{color:#0000FF; font-weight:bold}.pdoc .no{color:#880000}.pdoc .nd{color:#AA22FF}.pdoc .ni{color:#999999; font-weight:bold}.pdoc .ne{color:#D2413A; font-weight:bold}.pdoc .nf{color:#0000FF}.pdoc .nl{color:#A0A000}.pdoc .nn{color:#0000FF; font-weight:bold}.pdoc .nt{color:#008000; font-weight:bold}.pdoc .nv{color:#19177C}.pdoc .ow{color:#AA22FF; font-weight:bold}.pdoc .w{color:#bbbbbb}.pdoc .mb{color:#666666}.pdoc .mf{color:#666666}.pdoc .mh{color:#666666}.pdoc .mi{color:#666666}.pdoc .mo{color:#666666}.pdoc .sa{color:#BA2121}.pdoc .sb{color:#BA2121}.pdoc .sc{color:#BA2121}.pdoc .dl{color:#BA2121}.pdoc .sd{color:#BA2121; font-style:italic}.pdoc .s2{color:#BA2121}.pdoc .se{color:#BB6622; font-weight:bold}.pdoc .sh{color:#BA2121}.pdoc .si{color:#BB6688; font-weight:bold}.pdoc .sx{color:#008000}.pdoc .sr{color:#BB6688}.pdoc .s1{color:#BA2121}.pdoc .ss{color:#19177C}.pdoc .bp{color:#008000}.pdoc .fm{color:#0000FF}.pdoc .vc{color:#19177C}.pdoc .vg{color:#19177C}.pdoc .vi{color:#19177C}.pdoc .vm{color:#19177C}.pdoc .il{color:#666666}</style>
<style>/*! pdoc */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f7f7f7;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}body{background-color:var(--pdoc-background);}html, body{width:100%;height:100%;}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;}nav.pdoc{--pad:1.75rem;--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc li{display:block;margin:0;padding:.2rem 0 .2rem var(--indent);transition:all 100ms;}nav.pdoc > div > ul > li{padding-left:0;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}html, main{scroll-behavior:smooth;}.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{background-color:var(--code);border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.pdoc details{filter:opacity(1);}.pdoc details:not([open]){height:0;}.pdoc details > summary{position:absolute;top:-35px;right:0;font-size:.75rem;color:var(--muted);padding:0 .7em;user-select:none;}.pdoc details > summary:focus{outline:0;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc > section:first-of-type > .docstring{margin-bottom:2.5rem;}.pdoc .docstring pre{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc .headerlink{position:absolute;width:0;margin-left:-1.5rem;line-height:1.4rem;font-size:1.5rem;font-weight:normal;transition:all 100ms ease-in-out;opacity:0;user-select:none;}.pdoc .attr > .headerlink{margin-left:-2.5rem;}.pdoc *:hover > .headerlink,.pdoc *:target > .attr > .headerlink{opacity:1;}.pdoc .attr{display:block;color:var(--text);margin:.5rem 0 .5rem;padding:.4rem 5rem .4rem 1rem;background-color:var(--accent);}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{white-space:pre-wrap;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
</head>
<body>        <nav class="pdoc">
            <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
            <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
            <div>
                        <a class="pdoc-button module-list-button" href="../robosimpy.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                            &nbsp;robosimpy</a>


                        <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                               pattern=".+" required>



                    <h2>API Documentation</h2>
                        <ul class="memberlist">
            <li>
                    <a class="class" href="#RoboSimPyApp">RoboSimPyApp</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#RoboSimPyApp.__init__">RoboSimPyApp</a>
                        </li>
                        <li>
                                <a class="function" href="#RoboSimPyApp.build">build</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#RoboSimPyWidget">RoboSimPyWidget</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#RoboSimPyWidget.__init__">RoboSimPyWidget</a>
                        </li>
                        <li>
                                <a class="function" href="#RoboSimPyWidget.on_touch_down">on_touch_down</a>
                        </li>
                        <li>
                                <a class="function" href="#RoboSimPyWidget.on_touch_up">on_touch_up</a>
                        </li>
                        <li>
                                <a class="function" href="#RoboSimPyWidget.update">update</a>
                        </li>
                        <li>
                                <a class="function" href="#RoboSimPyWidget.draw_line">draw_line</a>
                        </li>
                        <li>
                                <a class="function" href="#RoboSimPyWidget.draw_point">draw_point</a>
                        </li>
                        <li>
                                <a class="function" href="#RoboSimPyWidget.draw_discrete_belief">draw_discrete_belief</a>
                        </li>
                        <li>
                                <a class="function" href="#RoboSimPyWidget.draw_particles">draw_particles</a>
                        </li>
                        <li>
                                <a class="function" href="#RoboSimPyWidget.draw_error_ellipse">draw_error_ellipse</a>
                        </li>
                        <li>
                                <a class="function" href="#RoboSimPyWidget.draw_lasers">draw_lasers</a>
                        </li>
                        <li>
                                <a class="function" href="#RoboSimPyWidget.draw_robot">draw_robot</a>
                        </li>
                        <li>
                                <a class="function" href="#RoboSimPyWidget.draw_world">draw_world</a>
                        </li>
                        <li>
                                <a class="function" href="#RoboSimPyWidget.draw_history">draw_history</a>
                        </li>
                        <li>
                                <a class="function" href="#RoboSimPyWidget.draw_collisions">draw_collisions</a>
                        </li>
                </ul>

            </li>
    </ul>



                    <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev">
                        built with <span class="visually-hidden">pdoc</span><img
                            alt="pdoc logo"
                            src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
                    </a>
            </div>
        </nav>
    <main class="pdoc">
            <section>
                    <h1 class="modulename">
<a href="./../robosimpy.html">robosimpy</a><wbr>.gui    </h1>

                        <div class="docstring"><p>Definitions for Kivy GUI elements and drawing functions, making up the visual frontend of the robot simulator.</p>
</div>

                        <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Definitions for Kivy GUI elements and drawing functions, making up the visual frontend of the robot simulator.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">kivy.app</span> <span class="kn">import</span> <span class="n">App</span>
<span class="kn">from</span> <span class="nn">kivy.clock</span> <span class="kn">import</span> <span class="n">Clock</span>
<span class="kn">from</span> <span class="nn">kivy.core.text</span> <span class="kn">import</span> <span class="n">Label</span> <span class="k">as</span> <span class="n">CoreLabel</span>
<span class="kn">from</span> <span class="nn">kivy.core.window</span> <span class="kn">import</span> <span class="n">Window</span>
<span class="kn">from</span> <span class="nn">kivy.graphics.context_instructions</span> <span class="kn">import</span> <span class="n">Color</span><span class="p">,</span> <span class="n">PushMatrix</span><span class="p">,</span> <span class="n">Rotate</span><span class="p">,</span> <span class="n">PopMatrix</span>
<span class="kn">from</span> <span class="nn">kivy.graphics.vertex_instructions</span> <span class="kn">import</span> <span class="n">Line</span><span class="p">,</span> <span class="n">Rectangle</span><span class="p">,</span> <span class="n">Point</span>
<span class="kn">from</span> <span class="nn">kivy.graphics.texture</span> <span class="kn">import</span> <span class="n">Texture</span>
<span class="kn">from</span> <span class="nn">kivy.graphics</span> <span class="kn">import</span> <span class="n">Ellipse</span>
<span class="kn">from</span> <span class="nn">kivy.uix.widget</span> <span class="kn">import</span> <span class="n">Widget</span>

<span class="kn">from</span> <span class="nn">.robots</span> <span class="kn">import</span> <span class="n">Robot</span>
<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Some default values</span>
<span class="n">DRAW_LABELS</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">METER_TO_PX</span> <span class="o">=</span> <span class="mf">30.0</span>
<span class="n">OFFSET_X</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">OFFSET_Y</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">DEFAULT_WINDOW_SIZE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">900</span><span class="p">,</span> <span class="mi">900</span><span class="p">)</span>
<span class="n">MAX_HISTORY</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># Global variables</span>
<span class="n">scale</span> <span class="o">=</span> <span class="n">METER_TO_PX</span>
<span class="n">ui_scale</span> <span class="o">=</span> <span class="mf">1.0</span>


<span class="k">class</span> <span class="nc">RoboSimPyApp</span><span class="p">(</span><span class="n">App</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subclass of Kivy App implementing GUI elements for the robot simulator.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">robot</span><span class="p">:</span> <span class="n">Robot</span><span class="p">,</span>
        <span class="n">state_update</span><span class="p">,</span>
        <span class="n">world</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">window_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">meter2px</span><span class="o">=</span><span class="n">METER_TO_PX</span><span class="p">,</span>
        <span class="n">gui_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">fixed_timestep</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        robot : Robot</span>
<span class="sd">            The robot to simulate.</span>

<span class="sd">        window_size : (int, int)</span>
<span class="sd">            Size of the map in pixels.</span>

<span class="sd">        state_update : function</span>
<span class="sd">            The function for the main simulation loop. Gets called up to 60 times a second.</span>

<span class="sd">        world : ndarray or None</span>
<span class="sd">            A 2D numpy array with shape n by 4 with the format [[x1,y1,x2,y2], ... ].</span>
<span class="sd">            Contains the definition of the walls for the simulation.</span>

<span class="sd">        meter2px :</span>
<span class="sd">            Scaling factor from meter to pixel.</span>

<span class="sd">        ui_scale : float</span>
<span class="sd">            Scaling factor for GUI elements. If you are using a high resolution display, you can increase</span>
<span class="sd">            the drawing size of simulator elements using this setting. Additionally, change meter2px</span>
<span class="sd">            to an appropriate setting for your display.</span>

<span class="sd">        fixed_timestep : bool</span>
<span class="sd">            Whether or not a fixed timestep is used for simulation.</span>
<span class="sd">            If true, all movement speed related settings are made in meter/timestep.</span>
<span class="sd">            If this setting is false, the simulator uses wall clock time and all</span>
<span class="sd">            movement speed related units are meter/second.</span>

<span class="sd">        kwargs</span>
<span class="sd">            Optional arguments for superclass.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">scale</span><span class="p">,</span> <span class="n">ui_scale</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robot</span> <span class="o">=</span> <span class="n">robot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_update</span> <span class="o">=</span> <span class="n">state_update</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="n">window_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixed_timestep</span> <span class="o">=</span> <span class="n">fixed_timestep</span>

        <span class="k">if</span> <span class="n">world</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">world</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">world</span><span class="p">)</span>
            <span class="n">world_size_x</span><span class="p">,</span> <span class="n">world_size_y</span> <span class="o">=</span> <span class="n">compute_world_size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">)</span>
            <span class="n">window_size_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">world_size_x</span> <span class="o">*</span> <span class="n">meter2px</span><span class="p">)</span> <span class="o">/</span> <span class="n">gui_scale</span>
            <span class="n">window_size_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">world_size_y</span> <span class="o">*</span> <span class="n">meter2px</span><span class="p">)</span> <span class="o">/</span> <span class="n">gui_scale</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">window_size_x</span><span class="p">,</span> <span class="n">window_size_y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">world</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="n">DEFAULT_WINDOW_SIZE</span>

        <span class="n">scale</span> <span class="o">=</span> <span class="n">meter2px</span>
        <span class="n">ui_scale</span> <span class="o">=</span> <span class="n">gui_scale</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets called by Kivy when starting the application.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        RoboSimPyAPI</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ui</span> <span class="o">=</span> <span class="n">RoboSimPyWidget</span><span class="p">(</span>
            <span class="n">robot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">,</span>
            <span class="n">world</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">,</span>
            <span class="n">state_update</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state_update</span><span class="p">,</span>
            <span class="n">fixed_timestep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fixed_timestep</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">Window</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span>
        <span class="n">Window</span><span class="o">.</span><span class="n">clearcolor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_interval</span><span class="p">(</span><span class="n">ui</span><span class="o">.</span><span class="n">update</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">60.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ui</span>


<span class="k">class</span> <span class="nc">RoboSimPyWidget</span><span class="p">(</span><span class="n">Widget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subclass of a Kivy widget implementing drawing methods specific to this robot simulator.</span>
<span class="sd">    To be able to call functions from an object of this class during simulation, you have to pass it as a</span>
<span class="sd">    parameter to your main simulation function (the &quot;state_update&quot;-Argument of RoboSimPyApp).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_inputs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>  <span class="c1"># mapping key code to actual character</span>
    <span class="n">_to_be_added</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_updates_per_frame</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">_history</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_collisions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">,</span> <span class="n">world</span><span class="p">,</span> <span class="n">state_update</span><span class="p">,</span> <span class="n">fixed_timestep</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        robot : Robot</span>
<span class="sd">            The robot to simulate.</span>

<span class="sd">        world : ndarray or None</span>
<span class="sd">            A 2D numpy array with shape n by 4 with the format [[x1,y1,x2,y2], ... ].</span>
<span class="sd">            Contains the definition of the walls for the simulation.</span>

<span class="sd">        state_update : function</span>
<span class="sd">            The function for the main simulation loop. Gets called up to 60 times a second.</span>

<span class="sd">        kwargs</span>
<span class="sd">            Optional arguments for superclass.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">world</span> <span class="o">=</span> <span class="n">world</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robot</span> <span class="o">=</span> <span class="n">robot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_logic</span> <span class="o">=</span> <span class="n">state_update</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixed_timestep</span> <span class="o">=</span> <span class="n">fixed_timestep</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_timestep</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>

        <span class="c1"># noinspection PyUnusedLocal</span>
        <span class="k">def</span> <span class="nf">_on_keyboard_down</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">scancode</span><span class="p">,</span> <span class="n">codepoint</span><span class="p">,</span> <span class="n">modifiers</span><span class="p">):</span>
            <span class="k">global</span> <span class="n">scale</span>
            <span class="c1"># Pfeiltasten separat behandeln</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">273</span><span class="p">:</span>
                <span class="n">codepoint</span> <span class="o">=</span> <span class="s2">&quot;up&quot;</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">275</span><span class="p">:</span>
                <span class="n">codepoint</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">274</span><span class="p">:</span>
                <span class="n">codepoint</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">276</span><span class="p">:</span>
                <span class="n">codepoint</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>
            <span class="c1"># Sonst:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">codepoint</span>
            <span class="k">if</span> <span class="s2">&quot;0&quot;</span> <span class="o">==</span> <span class="n">codepoint</span><span class="p">:</span>
                <span class="k">global</span> <span class="n">DRAW_LABELS</span>
                <span class="n">DRAW_LABELS</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">DRAW_LABELS</span>
            <span class="k">elif</span> <span class="s2">&quot;+&quot;</span> <span class="o">==</span> <span class="n">codepoint</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_updates_per_frame</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">+=</span> <span class="mf">0.25</span>
            <span class="k">elif</span> <span class="s2">&quot;-&quot;</span> <span class="o">==</span> <span class="n">codepoint</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_updates_per_frame</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">-</span> <span class="mf">0.25</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_updates_per_frame</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updates_per_frame</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;9&quot;</span> <span class="o">==</span> <span class="n">codepoint</span><span class="p">:</span>
                <span class="n">scale</span> <span class="o">+=</span> <span class="mf">0.1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_history</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">elif</span> <span class="s2">&quot;8&quot;</span> <span class="o">==</span> <span class="n">codepoint</span><span class="p">:</span>
                <span class="n">scale</span> <span class="o">-=</span> <span class="mf">0.1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_history</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># noinspection PyUnusedLocal</span>
        <span class="k">def</span> <span class="nf">_on_keyboard_up</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">scancode</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="n">Window</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_key_down</span><span class="o">=</span><span class="n">_on_keyboard_down</span><span class="p">)</span>
        <span class="n">Window</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_key_up</span><span class="o">=</span><span class="n">_on_keyboard_up</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_touch_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">touch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets called when the user clicks/touches the window of the application.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        touch</span>
<span class="sd">            A touch object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_to_be_added</span> <span class="o">=</span> <span class="n">touch</span><span class="o">.</span><span class="n">pos</span>  <span class="c1"># first point of new line</span>

    <span class="k">def</span> <span class="nf">on_touch_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">touch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets called when the user releases a click/touche on the window of the application.</span>
<span class="sd">        This function implements a simple routine to add/remove walls to the active simulation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        touch</span>
<span class="sd">            A touch object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># add new line to world</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">touch</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_be_added</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span>
            <span class="n">touch</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_be_added</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">world</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">*</span><span class="n">touch</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_be_added</span><span class="p">])</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if clicked on line: delete line</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">:]</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_be_added</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
                <span class="n">cross</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span>
                <span class="n">eps</span> <span class="o">=</span> <span class="mf">0.1</span>
                <span class="k">if</span> <span class="o">-</span><span class="n">eps</span> <span class="o">&lt;</span> <span class="n">cross</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">:</span>
                    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">((</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">),</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="n">a</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">world</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="k">break</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_to_be_added</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Main update routine. Calls the default drawing functions for the robot, robot path history,</span>
<span class="sd">        world, and collision markers as well as the user defined state_update function.</span>
<span class="sd">        Is scheduled to run up to 60 times a second.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot; &quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>  <span class="c1"># Space pauses simulation</span>
            <span class="k">return</span>

        <span class="n">prev_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_logic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_history</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_world</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_collisions</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_robot</span><span class="p">()</span>

        <span class="n">did_collide</span> <span class="o">=</span> <span class="n">collision</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">enclosure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">did_collide</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_collisions</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">prev_state</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_timestep</span><span class="p">:</span>
            <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
            <span class="n">diff_in_s</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_time</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-9</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_time</span> <span class="o">=</span> <span class="n">current_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">diff_in_s</span>

    <span class="k">def</span> <span class="nf">draw_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">pointsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">:</span>
            <span class="n">Color</span><span class="p">(</span><span class="o">*</span><span class="n">color</span><span class="p">)</span>
            <span class="n">Line</span><span class="p">(</span>
                <span class="n">points</span><span class="o">=</span><span class="p">[</span><span class="n">x0</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">y0</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">y1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">],</span>
                <span class="n">width</span><span class="o">=</span><span class="n">pointsize</span> <span class="o">/</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
                <span class="n">cap</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">pointsize</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">:</span>
            <span class="n">Color</span><span class="p">(</span><span class="o">*</span><span class="n">color</span><span class="p">)</span>
            <span class="n">ptsize</span> <span class="o">=</span> <span class="n">pointsize</span> <span class="o">*</span> <span class="n">ui_scale</span>
            <span class="n">Ellipse</span><span class="p">(</span>
                <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">-</span> <span class="n">ptsize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">-</span> <span class="n">ptsize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">ptsize</span><span class="p">,</span> <span class="n">ptsize</span><span class="p">),</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_discrete_belief</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">belief</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">,</span> <span class="n">world_size</span><span class="p">,</span> <span class="n">max_alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draws a grid based discrete probability distribution over a robot pose (that is 2D position and 1D orientation).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        belief: ndarray</span>
<span class="sd">            3D array with entries describing the probability of the robot being in this cell.</span>
<span class="sd">        grid_size: array</span>
<span class="sd">            3x1 vector describing the size of the belief grid.</span>
<span class="sd">            Entry 1: number of cells in x-direction.</span>
<span class="sd">            Entry 2: number of cells in y-direction.</span>
<span class="sd">            Entry 3: number of cells for possible angular range.</span>
<span class="sd">        world_size: array</span>
<span class="sd">            3x1 vector specifying the world size.</span>
<span class="sd">            Eintrag 1: size in x-direction.</span>
<span class="sd">            Eintrag 2: size in y-direction.</span>
<span class="sd">            Eintrag 3: size of angular range (in rad, if unrestricted: 2*np.pi)</span>
<span class="sd">        max_alpha:</span>
<span class="sd">            Maximum value of alpha channel for display, default is 1.0 (no opacity).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">texture</span> <span class="o">=</span> <span class="n">Texture</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">size</span><span class="o">=</span><span class="n">grid_size</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">colorfmt</span><span class="o">=</span><span class="s2">&quot;rgba&quot;</span><span class="p">,</span>
            <span class="n">icolorfmt</span><span class="o">=</span><span class="s2">&quot;rgba&quot;</span><span class="p">,</span>
            <span class="n">bufferfmt</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
            <span class="n">mipmap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">texture</span><span class="o">.</span><span class="n">mag_filter</span> <span class="o">=</span> <span class="s2">&quot;nearest&quot;</span>

        <span class="n">bel_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">belief</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="c1"># Calculate RGB value from HSV color space</span>
        <span class="n">angle_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">belief</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">vec_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_space</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_space</span><span class="p">)],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">avg_vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">belief</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">vec_space</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">avg_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">avg_vecs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">avg_vecs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">avg_angles</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">360.0</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>  <span class="c1"># max_alpha*bel_sum</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

        <span class="n">hi</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span> <span class="o">//</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">h</span> <span class="o">/</span> <span class="mf">60.0</span> <span class="o">-</span> <span class="n">hi</span>
        <span class="n">p</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">s</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">s</span> <span class="o">*</span> <span class="n">f</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">s</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">f</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">v</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">color</span><span class="p">[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">q</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">color</span><span class="p">[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">t</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">color</span><span class="p">[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">v</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">color</span><span class="p">[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">4</span><span class="p">]</span>
        <span class="n">color</span><span class="p">[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">5</span><span class="p">]</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">bel_sum</span> <span class="o">*</span> <span class="n">max_alpha</span>

        <span class="n">rgba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">texture</span><span class="o">.</span><span class="n">blit_buffer</span><span class="p">(</span><span class="n">rgba</span><span class="o">.</span><span class="n">tobytes</span><span class="p">(),</span> <span class="n">colorfmt</span><span class="o">=</span><span class="s2">&quot;rgba&quot;</span><span class="p">,</span> <span class="n">bufferfmt</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">:</span>
            <span class="n">Color</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">world_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">world_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>
            <span class="n">Rectangle</span><span class="p">(</span><span class="n">texture</span><span class="o">=</span><span class="n">texture</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_particles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">particles</span><span class="p">,</span> <span class="n">pointsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draws particles as a simple way to display a position and orientation, for example</span>
<span class="sd">        for Monte Carlo localization.</span>
<span class="sd">        The first argument &quot;particles&quot; may be a Nx2 or Nx3 array (with N := number of particles).</span>
<span class="sd">        The optional third entry in the second dimension gets interpreted as orientation and is displayed</span>
<span class="sd">        via a small line.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        particles : ndarray</span>
<span class="sd">            2D numpy array with the following structure:</span>
<span class="sd">            [[ x1, y1],</span>
<span class="sd">             [ x2, y2],</span>
<span class="sd">             ...</span>
<span class="sd">            ]</span>
<span class="sd">            OR</span>
<span class="sd">            3D numpy array with the following structure:</span>
<span class="sd">            [[ x1, y1, theta1],</span>
<span class="sd">             [ x2, y2, theta2],</span>
<span class="sd">             ...</span>
<span class="sd">            ]</span>
<span class="sd">        pointsize : int or None</span>
<span class="sd">            Size of the points drawn.</span>
<span class="sd">        color : tuple</span>
<span class="sd">            RGB or RGBA tuple.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">particles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">particles</span><span class="p">])</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">particles</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="p">):</span>  <span class="c1"># [[x1,y1],[x2,y2], ... ] or [x,y]</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">particles</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">draw_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">pointsize</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
                <span class="c1"># Point(points=(scale * particles.flatten()).tolist(), pointsize=pointsize)</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">particles</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span>
        <span class="p">):</span>  <span class="c1"># [[x1,y1,theta1],[x2,y2, theta2], ... ] or [x,y, theta]</span>
            
            <span class="k">for</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">particles</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">draw_point</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">pointsize</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">pointsize</span> <span class="o">*</span> <span class="mf">0.03</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">pointsize</span> <span class="o">*</span> <span class="mf">0.03</span>
                <span class="n">Line</span><span class="p">(</span>
                    <span class="n">points</span><span class="o">=</span><span class="p">[</span><span class="n">x0</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">y0</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">y1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">],</span>
                    <span class="n">width</span><span class="o">=</span><span class="n">pointsize</span> <span class="o">/</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
                    <span class="n">cap</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="c1"># Point(points=(scale * particles[:, :2].flatten()).tolist(), pointsize=pointsize)</span>
                <span class="c1"># for i in range(particles.shape[0]):</span>
                <span class="c1">#    p = particles[i, :2]</span>
                <span class="c1">#    t = particles[i, 2]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Wrong dimensions for drawing particles&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_error_ellipse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c_p</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draws a 3x3 covariance matrix C_p at the position pos by projecting into 2D space.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        c_p: ndarray</span>
<span class="sd">            Matrix to draw.</span>
<span class="sd">        pos: ndarray</span>
<span class="sd">            Center of the ellipse.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Src: https://scipython.com/book/chapter-7-matplotlib/examples/bmi-data-with-confidence-ellipses/</span>
        <span class="n">cov</span> <span class="o">=</span> <span class="n">c_p</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">eigvals</span><span class="p">,</span> <span class="n">eigvecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">eigvals</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">eigvals</span><span class="p">,</span> <span class="n">eigvecs</span> <span class="o">=</span> <span class="n">eigvals</span><span class="p">[</span><span class="n">order</span><span class="p">],</span> <span class="n">eigvecs</span><span class="p">[:,</span> <span class="n">order</span><span class="p">]</span>

        <span class="c1"># The anti-clockwise angle to rotate our ellipse by</span>
        <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span> <span class="o">=</span> <span class="n">eigvecs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">eigvecs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">vy</span><span class="p">,</span> <span class="n">vx</span><span class="p">)</span>

        <span class="c1"># Width and height of ellipse to draw</span>
        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eigvals</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">:</span>
            <span class="n">Color</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">PushMatrix</span><span class="p">()</span>
            <span class="n">Rotate</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">origin</span><span class="o">=</span><span class="n">scale</span> <span class="o">*</span> <span class="n">pos</span><span class="p">)</span>
            <span class="n">Line</span><span class="p">(</span>
                <span class="n">ellipse</span><span class="o">=</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">height</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
                    <span class="n">width</span><span class="p">,</span>
                    <span class="n">height</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">width</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">PopMatrix</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">draw_lasers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot_state</span><span class="p">,</span> <span class="n">hitpoints</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draws laser beams.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        robot_state : ndarray</span>
<span class="sd">            Pose (position and orientation) of the robot. This is the origin of the laser beams.</span>
<span class="sd">        hitpoints : ndarray</span>
<span class="sd">            Positions of intersections of laser beams with walls. May contain as many hitpoints as there are laser beams.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">:</span>
            <span class="n">Color</span><span class="p">(</span><span class="o">*</span><span class="n">color</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">hitpoints</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">p</span><span class="p">)):</span>
                    <span class="n">Line</span><span class="p">(</span>
                        <span class="n">points</span><span class="o">=</span><span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">*</span><span class="n">robot_state</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="o">*</span><span class="n">p</span><span class="p">]))</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                        <span class="n">width</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="n">DRAW_LABELS</span><span class="p">:</span>
                <span class="n">Color</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">hitpoints</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">p</span><span class="p">)):</span>
                        <span class="n">lbl_pos</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span> <span class="o">-</span> <span class="mi">8</span><span class="p">)</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">robot_state</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">lbl_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">distance</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="n">lbl_size</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lbl_text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span>
                            <span class="k">else</span> <span class="p">(</span><span class="mi">15</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">)</span>
                        <span class="p">)</span>

                        <span class="n">core_l</span> <span class="o">=</span> <span class="n">CoreLabel</span><span class="p">()</span>
                        <span class="n">core_l</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;font_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span> <span class="o">*</span> <span class="n">ui_scale</span>
                        <span class="n">core_l</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">lbl_text</span>
                        <span class="n">core_l</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
                        <span class="n">Rectangle</span><span class="p">(</span><span class="n">texture</span><span class="o">=</span><span class="n">core_l</span><span class="o">.</span><span class="n">texture</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">lbl_pos</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">lbl_size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_robot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draws the robot, that is the hull, the wheels, the connecting lines between the</span>
<span class="sd">        center of the robot coordinate system and each wheel and the center of the robot coordinate</span>
<span class="sd">        system as a green dot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">robot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_point</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="ow">in</span> <span class="n">robot</span><span class="o">.</span><span class="n">enclosure</span><span class="p">:</span>
            <span class="n">Color</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
            <span class="n">Line</span><span class="p">(</span>
                <span class="n">points</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">scale</span>
                    <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="p">(</span>
                                <span class="n">robot</span><span class="o">.</span><span class="n">pos</span>
                                <span class="o">+</span> <span class="n">rotate</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">))</span>
                            <span class="p">),</span>
                            <span class="p">(</span>
                                <span class="n">robot</span><span class="o">.</span><span class="n">pos</span>
                                <span class="o">+</span> <span class="n">rotate</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">))</span>
                            <span class="p">),</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">1.2</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">wheel</span> <span class="ow">in</span> <span class="n">robot</span><span class="o">.</span><span class="n">wheels</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">walpha</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wheel</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
            <span class="n">wbeta</span> <span class="o">=</span> <span class="n">wheel</span><span class="o">.</span><span class="n">beta</span>

            <span class="c1"># line l</span>
            <span class="n">Color</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
            <span class="p">[</span><span class="n">lx1</span><span class="p">,</span> <span class="n">ly1</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span>
                <span class="n">walpha</span> <span class="o">+</span> <span class="n">robot</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wheel</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">rlx</span><span class="p">,</span> <span class="n">rly</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lx1</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ly1</span>
            <span class="n">Line</span><span class="p">(</span>
                <span class="n">points</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rlx</span><span class="p">,</span> <span class="n">rly</span><span class="p">])</span>
                <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">width</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># line d</span>
            <span class="n">Color</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="p">[</span><span class="n">dx2</span><span class="p">,</span> <span class="n">dy2</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span>
                <span class="n">walpha</span> <span class="o">+</span> <span class="n">wbeta</span> <span class="o">+</span> <span class="n">robot</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wheel</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">rldx</span><span class="p">,</span> <span class="n">rldy</span> <span class="o">=</span> <span class="n">rlx</span> <span class="o">+</span> <span class="n">dx2</span><span class="p">,</span> <span class="n">rly</span> <span class="o">+</span> <span class="n">dy2</span>
            <span class="n">Line</span><span class="p">(</span>
                <span class="n">points</span><span class="o">=</span><span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rlx</span><span class="p">,</span> <span class="n">rly</span><span class="p">,</span> <span class="n">rldx</span><span class="p">,</span> <span class="n">rldy</span><span class="p">]))</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">width</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># wheel</span>
            <span class="n">Color</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="k">if</span> <span class="n">wheel</span><span class="o">.</span><span class="n">motor</span> <span class="k">else</span> <span class="n">Color</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">)</span>
            <span class="p">[</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span>
                <span class="n">walpha</span> <span class="o">+</span> <span class="n">wbeta</span> <span class="o">+</span> <span class="n">robot</span><span class="o">.</span><span class="n">theta</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">robot</span><span class="o">.</span><span class="n">wheel_radius</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">Line</span><span class="p">(</span>
                <span class="n">points</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rldx</span> <span class="o">+</span> <span class="n">rx</span><span class="p">,</span> <span class="n">rldy</span> <span class="o">+</span> <span class="n">ry</span><span class="p">,</span> <span class="n">rldx</span> <span class="o">-</span> <span class="n">rx</span><span class="p">,</span> <span class="n">rldy</span> <span class="o">-</span> <span class="n">ry</span><span class="p">])</span>
                <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
            <span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_point</span><span class="p">(</span><span class="n">rldx</span> <span class="o">+</span> <span class="n">rx</span><span class="p">,</span> <span class="n">rldy</span> <span class="o">+</span> <span class="n">ry</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">.2</span><span class="p">,</span> <span class="mf">.2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">draw_world</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draws the world as a collection of lines as defined by the world array.&quot;&quot;&quot;</span>
        <span class="n">Color</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">:</span>
            <span class="n">Line</span><span class="p">(</span>
                <span class="n">points</span><span class="o">=</span><span class="p">[</span><span class="n">scale</span> <span class="o">*</span> <span class="n">x1</span><span class="p">,</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">y1</span><span class="p">,</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">x2</span><span class="p">,</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">y2</span><span class="p">],</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">1.2</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draws the past trajectory of the robot.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">pos</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">MAX_HISTORY</span><span class="p">:</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">Color</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>
        <span class="n">Line</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.2</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_collisions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets used to mark the current position of a robot during a collision.&quot;&quot;&quot;</span>
        <span class="n">Color</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">Point</span><span class="p">(</span>
            <span class="n">points</span><span class="o">=</span><span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_collisions</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">pointsize</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ui_scale</span>
        <span class="p">)</span>
</pre></div>

        </details>

            </section>
                <section id="RoboSimPyApp">
                                <div class="attr class">
        <a class="headerlink" href="#RoboSimPyApp">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">RoboSimPyApp</span><wbr>(<span class="base">kivy.app.App</span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">RoboSimPyApp</span><span class="p">(</span><span class="n">App</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subclass of Kivy App implementing GUI elements for the robot simulator.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">robot</span><span class="p">:</span> <span class="n">Robot</span><span class="p">,</span>
        <span class="n">state_update</span><span class="p">,</span>
        <span class="n">world</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">window_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">meter2px</span><span class="o">=</span><span class="n">METER_TO_PX</span><span class="p">,</span>
        <span class="n">gui_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">fixed_timestep</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        robot : Robot</span>
<span class="sd">            The robot to simulate.</span>

<span class="sd">        window_size : (int, int)</span>
<span class="sd">            Size of the map in pixels.</span>

<span class="sd">        state_update : function</span>
<span class="sd">            The function for the main simulation loop. Gets called up to 60 times a second.</span>

<span class="sd">        world : ndarray or None</span>
<span class="sd">            A 2D numpy array with shape n by 4 with the format [[x1,y1,x2,y2], ... ].</span>
<span class="sd">            Contains the definition of the walls for the simulation.</span>

<span class="sd">        meter2px :</span>
<span class="sd">            Scaling factor from meter to pixel.</span>

<span class="sd">        ui_scale : float</span>
<span class="sd">            Scaling factor for GUI elements. If you are using a high resolution display, you can increase</span>
<span class="sd">            the drawing size of simulator elements using this setting. Additionally, change meter2px</span>
<span class="sd">            to an appropriate setting for your display.</span>

<span class="sd">        fixed_timestep : bool</span>
<span class="sd">            Whether or not a fixed timestep is used for simulation.</span>
<span class="sd">            If true, all movement speed related settings are made in meter/timestep.</span>
<span class="sd">            If this setting is false, the simulator uses wall clock time and all</span>
<span class="sd">            movement speed related units are meter/second.</span>

<span class="sd">        kwargs</span>
<span class="sd">            Optional arguments for superclass.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">scale</span><span class="p">,</span> <span class="n">ui_scale</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robot</span> <span class="o">=</span> <span class="n">robot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_update</span> <span class="o">=</span> <span class="n">state_update</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="n">window_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixed_timestep</span> <span class="o">=</span> <span class="n">fixed_timestep</span>

        <span class="k">if</span> <span class="n">world</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">world</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">world</span><span class="p">)</span>
            <span class="n">world_size_x</span><span class="p">,</span> <span class="n">world_size_y</span> <span class="o">=</span> <span class="n">compute_world_size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">)</span>
            <span class="n">window_size_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">world_size_x</span> <span class="o">*</span> <span class="n">meter2px</span><span class="p">)</span> <span class="o">/</span> <span class="n">gui_scale</span>
            <span class="n">window_size_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">world_size_y</span> <span class="o">*</span> <span class="n">meter2px</span><span class="p">)</span> <span class="o">/</span> <span class="n">gui_scale</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">window_size_x</span><span class="p">,</span> <span class="n">window_size_y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">world</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="n">DEFAULT_WINDOW_SIZE</span>

        <span class="n">scale</span> <span class="o">=</span> <span class="n">meter2px</span>
        <span class="n">ui_scale</span> <span class="o">=</span> <span class="n">gui_scale</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets called by Kivy when starting the application.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        RoboSimPyAPI</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ui</span> <span class="o">=</span> <span class="n">RoboSimPyWidget</span><span class="p">(</span>
            <span class="n">robot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">,</span>
            <span class="n">world</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">,</span>
            <span class="n">state_update</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state_update</span><span class="p">,</span>
            <span class="n">fixed_timestep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fixed_timestep</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">Window</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span>
        <span class="n">Window</span><span class="o">.</span><span class="n">clearcolor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_interval</span><span class="p">(</span><span class="n">ui</span><span class="o">.</span><span class="n">update</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">60.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ui</span>
</pre></div>

        </details>

            <div class="docstring"><p>Subclass of Kivy App implementing GUI elements for the robot simulator.</p>
</div>


                            <div id="RoboSimPyApp.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#RoboSimPyApp.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">RoboSimPyApp</span><span class="signature">(
    robot: <a href="robots.html#Robot">robosimpy.robots.Robot</a>,
    state_update,
    world=None,
    window_size=None,
    meter2px=30.0,
    gui_scale=1,
    fixed_timestep=True,
    **kwargs
)</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">robot</span><span class="p">:</span> <span class="n">Robot</span><span class="p">,</span>
        <span class="n">state_update</span><span class="p">,</span>
        <span class="n">world</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">window_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">meter2px</span><span class="o">=</span><span class="n">METER_TO_PX</span><span class="p">,</span>
        <span class="n">gui_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">fixed_timestep</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        robot : Robot</span>
<span class="sd">            The robot to simulate.</span>

<span class="sd">        window_size : (int, int)</span>
<span class="sd">            Size of the map in pixels.</span>

<span class="sd">        state_update : function</span>
<span class="sd">            The function for the main simulation loop. Gets called up to 60 times a second.</span>

<span class="sd">        world : ndarray or None</span>
<span class="sd">            A 2D numpy array with shape n by 4 with the format [[x1,y1,x2,y2], ... ].</span>
<span class="sd">            Contains the definition of the walls for the simulation.</span>

<span class="sd">        meter2px :</span>
<span class="sd">            Scaling factor from meter to pixel.</span>

<span class="sd">        ui_scale : float</span>
<span class="sd">            Scaling factor for GUI elements. If you are using a high resolution display, you can increase</span>
<span class="sd">            the drawing size of simulator elements using this setting. Additionally, change meter2px</span>
<span class="sd">            to an appropriate setting for your display.</span>

<span class="sd">        fixed_timestep : bool</span>
<span class="sd">            Whether or not a fixed timestep is used for simulation.</span>
<span class="sd">            If true, all movement speed related settings are made in meter/timestep.</span>
<span class="sd">            If this setting is false, the simulator uses wall clock time and all</span>
<span class="sd">            movement speed related units are meter/second.</span>

<span class="sd">        kwargs</span>
<span class="sd">            Optional arguments for superclass.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">scale</span><span class="p">,</span> <span class="n">ui_scale</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robot</span> <span class="o">=</span> <span class="n">robot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_update</span> <span class="o">=</span> <span class="n">state_update</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="n">window_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixed_timestep</span> <span class="o">=</span> <span class="n">fixed_timestep</span>

        <span class="k">if</span> <span class="n">world</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">world</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">world</span><span class="p">)</span>
            <span class="n">world_size_x</span><span class="p">,</span> <span class="n">world_size_y</span> <span class="o">=</span> <span class="n">compute_world_size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">)</span>
            <span class="n">window_size_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">world_size_x</span> <span class="o">*</span> <span class="n">meter2px</span><span class="p">)</span> <span class="o">/</span> <span class="n">gui_scale</span>
            <span class="n">window_size_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">world_size_y</span> <span class="o">*</span> <span class="n">meter2px</span><span class="p">)</span> <span class="o">/</span> <span class="n">gui_scale</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">window_size_x</span><span class="p">,</span> <span class="n">window_size_y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">world</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="n">DEFAULT_WINDOW_SIZE</span>

        <span class="n">scale</span> <span class="o">=</span> <span class="n">meter2px</span>
        <span class="n">ui_scale</span> <span class="o">=</span> <span class="n">gui_scale</span>
</pre></div>

        </details>

            <div class="docstring"><h2 id="parameters">Parameters</h2>

<p>robot : Robot
    The robot to simulate.</p>

<p>window_size : (int, int)
    Size of the map in pixels.</p>

<p>state_update : function
    The function for the main simulation loop. Gets called up to 60 times a second.</p>

<p>world : ndarray or None
    A 2D numpy array with shape n by 4 with the format [[x1,y1,x2,y2], ... ].
    Contains the definition of the walls for the simulation.</p>

<p>meter2px :
    Scaling factor from meter to pixel.</p>

<p>ui_scale : float
    Scaling factor for GUI elements. If you are using a high resolution display, you can increase
    the drawing size of simulator elements using this setting. Additionally, change meter2px
    to an appropriate setting for your display.</p>

<p>fixed_timestep : bool
    Whether or not a fixed timestep is used for simulation.
    If true, all movement speed related settings are made in meter/timestep.
    If this setting is false, the simulator uses wall clock time and all
    movement speed related units are meter/second.</p>

<p>kwargs
    Optional arguments for superclass.</p>
</div>


                            </div>
                            <div id="RoboSimPyApp.build" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#RoboSimPyApp.build">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">build</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets called by Kivy when starting the application.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        RoboSimPyAPI</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ui</span> <span class="o">=</span> <span class="n">RoboSimPyWidget</span><span class="p">(</span>
            <span class="n">robot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">,</span>
            <span class="n">world</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">,</span>
            <span class="n">state_update</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state_update</span><span class="p">,</span>
            <span class="n">fixed_timestep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fixed_timestep</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">Window</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span>
        <span class="n">Window</span><span class="o">.</span><span class="n">clearcolor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_interval</span><span class="p">(</span><span class="n">ui</span><span class="o">.</span><span class="n">update</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">60.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ui</span>
</pre></div>

        </details>

            <div class="docstring"><p>Gets called by Kivy when starting the application.</p>

<h2 id="returns">Returns</h2>

<p>RoboSimPyAPI</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>kivy.app.App</dt>
                                <dd id="RoboSimPyApp.title" class="variable">title</dd>
                <dd id="RoboSimPyApp.icon" class="variable">icon</dd>
                <dd id="RoboSimPyApp.use_kivy_settings" class="variable">use_kivy_settings</dd>
                <dd id="RoboSimPyApp.settings_cls" class="variable">settings_cls</dd>
                <dd id="RoboSimPyApp.kv_directory" class="variable">kv_directory</dd>
                <dd id="RoboSimPyApp.kv_file" class="variable">kv_file</dd>
                <dd id="RoboSimPyApp.build_config" class="function">build_config</dd>
                <dd id="RoboSimPyApp.build_settings" class="function">build_settings</dd>
                <dd id="RoboSimPyApp.load_kv" class="function">load_kv</dd>
                <dd id="RoboSimPyApp.get_application_name" class="function">get_application_name</dd>
                <dd id="RoboSimPyApp.get_application_icon" class="function">get_application_icon</dd>
                <dd id="RoboSimPyApp.get_application_config" class="function">get_application_config</dd>
                <dd id="RoboSimPyApp.root_window" class="variable">root_window</dd>
                <dd id="RoboSimPyApp.load_config" class="function">load_config</dd>
                <dd id="RoboSimPyApp.directory" class="variable">directory</dd>
                <dd id="RoboSimPyApp.user_data_dir" class="variable">user_data_dir</dd>
                <dd id="RoboSimPyApp.name" class="variable">name</dd>
                <dd id="RoboSimPyApp.run" class="function">run</dd>
                <dd id="RoboSimPyApp.async_run" class="function">async_run</dd>
                <dd id="RoboSimPyApp.stop" class="function">stop</dd>
                <dd id="RoboSimPyApp.on_start" class="function">on_start</dd>
                <dd id="RoboSimPyApp.on_stop" class="function">on_stop</dd>
                <dd id="RoboSimPyApp.on_pause" class="function">on_pause</dd>
                <dd id="RoboSimPyApp.on_resume" class="function">on_resume</dd>
                <dd id="RoboSimPyApp.get_running_app" class="function">get_running_app</dd>
                <dd id="RoboSimPyApp.on_config_change" class="function">on_config_change</dd>
                <dd id="RoboSimPyApp.open_settings" class="function">open_settings</dd>
                <dd id="RoboSimPyApp.display_settings" class="function">display_settings</dd>
                <dd id="RoboSimPyApp.close_settings" class="function">close_settings</dd>
                <dd id="RoboSimPyApp.create_settings" class="function">create_settings</dd>
                <dd id="RoboSimPyApp.destroy_settings" class="function">destroy_settings</dd>
                <dd id="RoboSimPyApp.on_title" class="function">on_title</dd>
                <dd id="RoboSimPyApp.on_icon" class="function">on_icon</dd>

            </div>
            <div><dt>kivy._event.EventDispatcher</dt>
                                <dd id="RoboSimPyApp.register_event_type" class="function">register_event_type</dd>
                <dd id="RoboSimPyApp.unregister_event_types" class="function">unregister_event_types</dd>
                <dd id="RoboSimPyApp.is_event_type" class="function">is_event_type</dd>
                <dd id="RoboSimPyApp.bind" class="function">bind</dd>
                <dd id="RoboSimPyApp.unbind" class="function">unbind</dd>
                <dd id="RoboSimPyApp.fbind" class="function">fbind</dd>
                <dd id="RoboSimPyApp.funbind" class="function">funbind</dd>
                <dd id="RoboSimPyApp.unbind_uid" class="function">unbind_uid</dd>
                <dd id="RoboSimPyApp.get_property_observers" class="function">get_property_observers</dd>
                <dd id="RoboSimPyApp.events" class="function">events</dd>
                <dd id="RoboSimPyApp.dispatch" class="function">dispatch</dd>
                <dd id="RoboSimPyApp.dispatch_generic" class="function">dispatch_generic</dd>
                <dd id="RoboSimPyApp.dispatch_children" class="function">dispatch_children</dd>
                <dd id="RoboSimPyApp.setter" class="function">setter</dd>
                <dd id="RoboSimPyApp.getter" class="function">getter</dd>
                <dd id="RoboSimPyApp.property" class="function">property</dd>
                <dd id="RoboSimPyApp.properties" class="function">properties</dd>
                <dd id="RoboSimPyApp.create_property" class="function">create_property</dd>
                <dd id="RoboSimPyApp.apply_property" class="function">apply_property</dd>
                <dd id="RoboSimPyApp.proxy_ref" class="variable">proxy_ref</dd>

            </div>
            <div><dt>kivy._event.ObjectWithUid</dt>
                                <dd id="RoboSimPyApp.uid" class="variable">uid</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="RoboSimPyWidget">
                                <div class="attr class">
        <a class="headerlink" href="#RoboSimPyWidget">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">RoboSimPyWidget</span><wbr>(<span class="base">kivy.uix.widget.Widget</span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">RoboSimPyWidget</span><span class="p">(</span><span class="n">Widget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subclass of a Kivy widget implementing drawing methods specific to this robot simulator.</span>
<span class="sd">    To be able to call functions from an object of this class during simulation, you have to pass it as a</span>
<span class="sd">    parameter to your main simulation function (the &quot;state_update&quot;-Argument of RoboSimPyApp).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_inputs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>  <span class="c1"># mapping key code to actual character</span>
    <span class="n">_to_be_added</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_updates_per_frame</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">_history</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_collisions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">,</span> <span class="n">world</span><span class="p">,</span> <span class="n">state_update</span><span class="p">,</span> <span class="n">fixed_timestep</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        robot : Robot</span>
<span class="sd">            The robot to simulate.</span>

<span class="sd">        world : ndarray or None</span>
<span class="sd">            A 2D numpy array with shape n by 4 with the format [[x1,y1,x2,y2], ... ].</span>
<span class="sd">            Contains the definition of the walls for the simulation.</span>

<span class="sd">        state_update : function</span>
<span class="sd">            The function for the main simulation loop. Gets called up to 60 times a second.</span>

<span class="sd">        kwargs</span>
<span class="sd">            Optional arguments for superclass.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">world</span> <span class="o">=</span> <span class="n">world</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robot</span> <span class="o">=</span> <span class="n">robot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_logic</span> <span class="o">=</span> <span class="n">state_update</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixed_timestep</span> <span class="o">=</span> <span class="n">fixed_timestep</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_timestep</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>

        <span class="c1"># noinspection PyUnusedLocal</span>
        <span class="k">def</span> <span class="nf">_on_keyboard_down</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">scancode</span><span class="p">,</span> <span class="n">codepoint</span><span class="p">,</span> <span class="n">modifiers</span><span class="p">):</span>
            <span class="k">global</span> <span class="n">scale</span>
            <span class="c1"># Pfeiltasten separat behandeln</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">273</span><span class="p">:</span>
                <span class="n">codepoint</span> <span class="o">=</span> <span class="s2">&quot;up&quot;</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">275</span><span class="p">:</span>
                <span class="n">codepoint</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">274</span><span class="p">:</span>
                <span class="n">codepoint</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">276</span><span class="p">:</span>
                <span class="n">codepoint</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>
            <span class="c1"># Sonst:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">codepoint</span>
            <span class="k">if</span> <span class="s2">&quot;0&quot;</span> <span class="o">==</span> <span class="n">codepoint</span><span class="p">:</span>
                <span class="k">global</span> <span class="n">DRAW_LABELS</span>
                <span class="n">DRAW_LABELS</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">DRAW_LABELS</span>
            <span class="k">elif</span> <span class="s2">&quot;+&quot;</span> <span class="o">==</span> <span class="n">codepoint</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_updates_per_frame</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">+=</span> <span class="mf">0.25</span>
            <span class="k">elif</span> <span class="s2">&quot;-&quot;</span> <span class="o">==</span> <span class="n">codepoint</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_updates_per_frame</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">-</span> <span class="mf">0.25</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_updates_per_frame</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updates_per_frame</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;9&quot;</span> <span class="o">==</span> <span class="n">codepoint</span><span class="p">:</span>
                <span class="n">scale</span> <span class="o">+=</span> <span class="mf">0.1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_history</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">elif</span> <span class="s2">&quot;8&quot;</span> <span class="o">==</span> <span class="n">codepoint</span><span class="p">:</span>
                <span class="n">scale</span> <span class="o">-=</span> <span class="mf">0.1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_history</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># noinspection PyUnusedLocal</span>
        <span class="k">def</span> <span class="nf">_on_keyboard_up</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">scancode</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="n">Window</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_key_down</span><span class="o">=</span><span class="n">_on_keyboard_down</span><span class="p">)</span>
        <span class="n">Window</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_key_up</span><span class="o">=</span><span class="n">_on_keyboard_up</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_touch_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">touch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets called when the user clicks/touches the window of the application.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        touch</span>
<span class="sd">            A touch object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_to_be_added</span> <span class="o">=</span> <span class="n">touch</span><span class="o">.</span><span class="n">pos</span>  <span class="c1"># first point of new line</span>

    <span class="k">def</span> <span class="nf">on_touch_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">touch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets called when the user releases a click/touche on the window of the application.</span>
<span class="sd">        This function implements a simple routine to add/remove walls to the active simulation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        touch</span>
<span class="sd">            A touch object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># add new line to world</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">touch</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_be_added</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span>
            <span class="n">touch</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_be_added</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">world</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">*</span><span class="n">touch</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_be_added</span><span class="p">])</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if clicked on line: delete line</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">:]</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_be_added</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
                <span class="n">cross</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span>
                <span class="n">eps</span> <span class="o">=</span> <span class="mf">0.1</span>
                <span class="k">if</span> <span class="o">-</span><span class="n">eps</span> <span class="o">&lt;</span> <span class="n">cross</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">:</span>
                    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">((</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">),</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="n">a</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">world</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="k">break</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_to_be_added</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Main update routine. Calls the default drawing functions for the robot, robot path history,</span>
<span class="sd">        world, and collision markers as well as the user defined state_update function.</span>
<span class="sd">        Is scheduled to run up to 60 times a second.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot; &quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>  <span class="c1"># Space pauses simulation</span>
            <span class="k">return</span>

        <span class="n">prev_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_logic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_history</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_world</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_collisions</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_robot</span><span class="p">()</span>

        <span class="n">did_collide</span> <span class="o">=</span> <span class="n">collision</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">enclosure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">did_collide</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_collisions</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">prev_state</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_timestep</span><span class="p">:</span>
            <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
            <span class="n">diff_in_s</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_time</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-9</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_time</span> <span class="o">=</span> <span class="n">current_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">diff_in_s</span>

    <span class="k">def</span> <span class="nf">draw_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">pointsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">:</span>
            <span class="n">Color</span><span class="p">(</span><span class="o">*</span><span class="n">color</span><span class="p">)</span>
            <span class="n">Line</span><span class="p">(</span>
                <span class="n">points</span><span class="o">=</span><span class="p">[</span><span class="n">x0</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">y0</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">y1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">],</span>
                <span class="n">width</span><span class="o">=</span><span class="n">pointsize</span> <span class="o">/</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
                <span class="n">cap</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">pointsize</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">:</span>
            <span class="n">Color</span><span class="p">(</span><span class="o">*</span><span class="n">color</span><span class="p">)</span>
            <span class="n">ptsize</span> <span class="o">=</span> <span class="n">pointsize</span> <span class="o">*</span> <span class="n">ui_scale</span>
            <span class="n">Ellipse</span><span class="p">(</span>
                <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">-</span> <span class="n">ptsize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">-</span> <span class="n">ptsize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">ptsize</span><span class="p">,</span> <span class="n">ptsize</span><span class="p">),</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_discrete_belief</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">belief</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">,</span> <span class="n">world_size</span><span class="p">,</span> <span class="n">max_alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draws a grid based discrete probability distribution over a robot pose (that is 2D position and 1D orientation).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        belief: ndarray</span>
<span class="sd">            3D array with entries describing the probability of the robot being in this cell.</span>
<span class="sd">        grid_size: array</span>
<span class="sd">            3x1 vector describing the size of the belief grid.</span>
<span class="sd">            Entry 1: number of cells in x-direction.</span>
<span class="sd">            Entry 2: number of cells in y-direction.</span>
<span class="sd">            Entry 3: number of cells for possible angular range.</span>
<span class="sd">        world_size: array</span>
<span class="sd">            3x1 vector specifying the world size.</span>
<span class="sd">            Eintrag 1: size in x-direction.</span>
<span class="sd">            Eintrag 2: size in y-direction.</span>
<span class="sd">            Eintrag 3: size of angular range (in rad, if unrestricted: 2*np.pi)</span>
<span class="sd">        max_alpha:</span>
<span class="sd">            Maximum value of alpha channel for display, default is 1.0 (no opacity).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">texture</span> <span class="o">=</span> <span class="n">Texture</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">size</span><span class="o">=</span><span class="n">grid_size</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">colorfmt</span><span class="o">=</span><span class="s2">&quot;rgba&quot;</span><span class="p">,</span>
            <span class="n">icolorfmt</span><span class="o">=</span><span class="s2">&quot;rgba&quot;</span><span class="p">,</span>
            <span class="n">bufferfmt</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
            <span class="n">mipmap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">texture</span><span class="o">.</span><span class="n">mag_filter</span> <span class="o">=</span> <span class="s2">&quot;nearest&quot;</span>

        <span class="n">bel_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">belief</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="c1"># Calculate RGB value from HSV color space</span>
        <span class="n">angle_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">belief</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">vec_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_space</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_space</span><span class="p">)],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">avg_vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">belief</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">vec_space</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">avg_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">avg_vecs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">avg_vecs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">avg_angles</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">360.0</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>  <span class="c1"># max_alpha*bel_sum</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

        <span class="n">hi</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span> <span class="o">//</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">h</span> <span class="o">/</span> <span class="mf">60.0</span> <span class="o">-</span> <span class="n">hi</span>
        <span class="n">p</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">s</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">s</span> <span class="o">*</span> <span class="n">f</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">s</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">f</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">v</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">color</span><span class="p">[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">q</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">color</span><span class="p">[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">t</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">color</span><span class="p">[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">v</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">color</span><span class="p">[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">4</span><span class="p">]</span>
        <span class="n">color</span><span class="p">[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">5</span><span class="p">]</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">bel_sum</span> <span class="o">*</span> <span class="n">max_alpha</span>

        <span class="n">rgba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">texture</span><span class="o">.</span><span class="n">blit_buffer</span><span class="p">(</span><span class="n">rgba</span><span class="o">.</span><span class="n">tobytes</span><span class="p">(),</span> <span class="n">colorfmt</span><span class="o">=</span><span class="s2">&quot;rgba&quot;</span><span class="p">,</span> <span class="n">bufferfmt</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">:</span>
            <span class="n">Color</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">world_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">world_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>
            <span class="n">Rectangle</span><span class="p">(</span><span class="n">texture</span><span class="o">=</span><span class="n">texture</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_particles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">particles</span><span class="p">,</span> <span class="n">pointsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draws particles as a simple way to display a position and orientation, for example</span>
<span class="sd">        for Monte Carlo localization.</span>
<span class="sd">        The first argument &quot;particles&quot; may be a Nx2 or Nx3 array (with N := number of particles).</span>
<span class="sd">        The optional third entry in the second dimension gets interpreted as orientation and is displayed</span>
<span class="sd">        via a small line.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        particles : ndarray</span>
<span class="sd">            2D numpy array with the following structure:</span>
<span class="sd">            [[ x1, y1],</span>
<span class="sd">             [ x2, y2],</span>
<span class="sd">             ...</span>
<span class="sd">            ]</span>
<span class="sd">            OR</span>
<span class="sd">            3D numpy array with the following structure:</span>
<span class="sd">            [[ x1, y1, theta1],</span>
<span class="sd">             [ x2, y2, theta2],</span>
<span class="sd">             ...</span>
<span class="sd">            ]</span>
<span class="sd">        pointsize : int or None</span>
<span class="sd">            Size of the points drawn.</span>
<span class="sd">        color : tuple</span>
<span class="sd">            RGB or RGBA tuple.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">particles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">particles</span><span class="p">])</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">particles</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="p">):</span>  <span class="c1"># [[x1,y1],[x2,y2], ... ] or [x,y]</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">particles</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">draw_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">pointsize</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
                <span class="c1"># Point(points=(scale * particles.flatten()).tolist(), pointsize=pointsize)</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">particles</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span>
        <span class="p">):</span>  <span class="c1"># [[x1,y1,theta1],[x2,y2, theta2], ... ] or [x,y, theta]</span>
            
            <span class="k">for</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">particles</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">draw_point</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">pointsize</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">pointsize</span> <span class="o">*</span> <span class="mf">0.03</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">pointsize</span> <span class="o">*</span> <span class="mf">0.03</span>
                <span class="n">Line</span><span class="p">(</span>
                    <span class="n">points</span><span class="o">=</span><span class="p">[</span><span class="n">x0</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">y0</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">y1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">],</span>
                    <span class="n">width</span><span class="o">=</span><span class="n">pointsize</span> <span class="o">/</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
                    <span class="n">cap</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="c1"># Point(points=(scale * particles[:, :2].flatten()).tolist(), pointsize=pointsize)</span>
                <span class="c1"># for i in range(particles.shape[0]):</span>
                <span class="c1">#    p = particles[i, :2]</span>
                <span class="c1">#    t = particles[i, 2]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Wrong dimensions for drawing particles&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_error_ellipse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c_p</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draws a 3x3 covariance matrix C_p at the position pos by projecting into 2D space.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        c_p: ndarray</span>
<span class="sd">            Matrix to draw.</span>
<span class="sd">        pos: ndarray</span>
<span class="sd">            Center of the ellipse.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Src: https://scipython.com/book/chapter-7-matplotlib/examples/bmi-data-with-confidence-ellipses/</span>
        <span class="n">cov</span> <span class="o">=</span> <span class="n">c_p</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">eigvals</span><span class="p">,</span> <span class="n">eigvecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">eigvals</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">eigvals</span><span class="p">,</span> <span class="n">eigvecs</span> <span class="o">=</span> <span class="n">eigvals</span><span class="p">[</span><span class="n">order</span><span class="p">],</span> <span class="n">eigvecs</span><span class="p">[:,</span> <span class="n">order</span><span class="p">]</span>

        <span class="c1"># The anti-clockwise angle to rotate our ellipse by</span>
        <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span> <span class="o">=</span> <span class="n">eigvecs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">eigvecs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">vy</span><span class="p">,</span> <span class="n">vx</span><span class="p">)</span>

        <span class="c1"># Width and height of ellipse to draw</span>
        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eigvals</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">:</span>
            <span class="n">Color</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">PushMatrix</span><span class="p">()</span>
            <span class="n">Rotate</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">origin</span><span class="o">=</span><span class="n">scale</span> <span class="o">*</span> <span class="n">pos</span><span class="p">)</span>
            <span class="n">Line</span><span class="p">(</span>
                <span class="n">ellipse</span><span class="o">=</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">height</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
                    <span class="n">width</span><span class="p">,</span>
                    <span class="n">height</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">width</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">PopMatrix</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">draw_lasers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot_state</span><span class="p">,</span> <span class="n">hitpoints</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draws laser beams.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        robot_state : ndarray</span>
<span class="sd">            Pose (position and orientation) of the robot. This is the origin of the laser beams.</span>
<span class="sd">        hitpoints : ndarray</span>
<span class="sd">            Positions of intersections of laser beams with walls. May contain as many hitpoints as there are laser beams.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">:</span>
            <span class="n">Color</span><span class="p">(</span><span class="o">*</span><span class="n">color</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">hitpoints</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">p</span><span class="p">)):</span>
                    <span class="n">Line</span><span class="p">(</span>
                        <span class="n">points</span><span class="o">=</span><span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">*</span><span class="n">robot_state</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="o">*</span><span class="n">p</span><span class="p">]))</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                        <span class="n">width</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="n">DRAW_LABELS</span><span class="p">:</span>
                <span class="n">Color</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">hitpoints</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">p</span><span class="p">)):</span>
                        <span class="n">lbl_pos</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span> <span class="o">-</span> <span class="mi">8</span><span class="p">)</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">robot_state</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">lbl_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">distance</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="n">lbl_size</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lbl_text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span>
                            <span class="k">else</span> <span class="p">(</span><span class="mi">15</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">)</span>
                        <span class="p">)</span>

                        <span class="n">core_l</span> <span class="o">=</span> <span class="n">CoreLabel</span><span class="p">()</span>
                        <span class="n">core_l</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;font_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span> <span class="o">*</span> <span class="n">ui_scale</span>
                        <span class="n">core_l</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">lbl_text</span>
                        <span class="n">core_l</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
                        <span class="n">Rectangle</span><span class="p">(</span><span class="n">texture</span><span class="o">=</span><span class="n">core_l</span><span class="o">.</span><span class="n">texture</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">lbl_pos</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">lbl_size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_robot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draws the robot, that is the hull, the wheels, the connecting lines between the</span>
<span class="sd">        center of the robot coordinate system and each wheel and the center of the robot coordinate</span>
<span class="sd">        system as a green dot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">robot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_point</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="ow">in</span> <span class="n">robot</span><span class="o">.</span><span class="n">enclosure</span><span class="p">:</span>
            <span class="n">Color</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
            <span class="n">Line</span><span class="p">(</span>
                <span class="n">points</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">scale</span>
                    <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="p">(</span>
                                <span class="n">robot</span><span class="o">.</span><span class="n">pos</span>
                                <span class="o">+</span> <span class="n">rotate</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">))</span>
                            <span class="p">),</span>
                            <span class="p">(</span>
                                <span class="n">robot</span><span class="o">.</span><span class="n">pos</span>
                                <span class="o">+</span> <span class="n">rotate</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">))</span>
                            <span class="p">),</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">1.2</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">wheel</span> <span class="ow">in</span> <span class="n">robot</span><span class="o">.</span><span class="n">wheels</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">walpha</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wheel</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
            <span class="n">wbeta</span> <span class="o">=</span> <span class="n">wheel</span><span class="o">.</span><span class="n">beta</span>

            <span class="c1"># line l</span>
            <span class="n">Color</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
            <span class="p">[</span><span class="n">lx1</span><span class="p">,</span> <span class="n">ly1</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span>
                <span class="n">walpha</span> <span class="o">+</span> <span class="n">robot</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wheel</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">rlx</span><span class="p">,</span> <span class="n">rly</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lx1</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ly1</span>
            <span class="n">Line</span><span class="p">(</span>
                <span class="n">points</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rlx</span><span class="p">,</span> <span class="n">rly</span><span class="p">])</span>
                <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">width</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># line d</span>
            <span class="n">Color</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="p">[</span><span class="n">dx2</span><span class="p">,</span> <span class="n">dy2</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span>
                <span class="n">walpha</span> <span class="o">+</span> <span class="n">wbeta</span> <span class="o">+</span> <span class="n">robot</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wheel</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">rldx</span><span class="p">,</span> <span class="n">rldy</span> <span class="o">=</span> <span class="n">rlx</span> <span class="o">+</span> <span class="n">dx2</span><span class="p">,</span> <span class="n">rly</span> <span class="o">+</span> <span class="n">dy2</span>
            <span class="n">Line</span><span class="p">(</span>
                <span class="n">points</span><span class="o">=</span><span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rlx</span><span class="p">,</span> <span class="n">rly</span><span class="p">,</span> <span class="n">rldx</span><span class="p">,</span> <span class="n">rldy</span><span class="p">]))</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">width</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># wheel</span>
            <span class="n">Color</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="k">if</span> <span class="n">wheel</span><span class="o">.</span><span class="n">motor</span> <span class="k">else</span> <span class="n">Color</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">)</span>
            <span class="p">[</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span>
                <span class="n">walpha</span> <span class="o">+</span> <span class="n">wbeta</span> <span class="o">+</span> <span class="n">robot</span><span class="o">.</span><span class="n">theta</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">robot</span><span class="o">.</span><span class="n">wheel_radius</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">Line</span><span class="p">(</span>
                <span class="n">points</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rldx</span> <span class="o">+</span> <span class="n">rx</span><span class="p">,</span> <span class="n">rldy</span> <span class="o">+</span> <span class="n">ry</span><span class="p">,</span> <span class="n">rldx</span> <span class="o">-</span> <span class="n">rx</span><span class="p">,</span> <span class="n">rldy</span> <span class="o">-</span> <span class="n">ry</span><span class="p">])</span>
                <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
            <span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_point</span><span class="p">(</span><span class="n">rldx</span> <span class="o">+</span> <span class="n">rx</span><span class="p">,</span> <span class="n">rldy</span> <span class="o">+</span> <span class="n">ry</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">.2</span><span class="p">,</span> <span class="mf">.2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">draw_world</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draws the world as a collection of lines as defined by the world array.&quot;&quot;&quot;</span>
        <span class="n">Color</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">:</span>
            <span class="n">Line</span><span class="p">(</span>
                <span class="n">points</span><span class="o">=</span><span class="p">[</span><span class="n">scale</span> <span class="o">*</span> <span class="n">x1</span><span class="p">,</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">y1</span><span class="p">,</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">x2</span><span class="p">,</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">y2</span><span class="p">],</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">1.2</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draws the past trajectory of the robot.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">pos</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">MAX_HISTORY</span><span class="p">:</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">Color</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>
        <span class="n">Line</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.2</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_collisions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets used to mark the current position of a robot during a collision.&quot;&quot;&quot;</span>
        <span class="n">Color</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">Point</span><span class="p">(</span>
            <span class="n">points</span><span class="o">=</span><span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_collisions</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">pointsize</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ui_scale</span>
        <span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Subclass of a Kivy widget implementing drawing methods specific to this robot simulator.
To be able to call functions from an object of this class during simulation, you have to pass it as a
parameter to your main simulation function (the "state_update"-Argument of RoboSimPyApp).</p>
</div>


                            <div id="RoboSimPyWidget.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#RoboSimPyWidget.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">RoboSimPyWidget</span><span class="signature">(robot, world, state_update, fixed_timestep, **kwargs)</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">,</span> <span class="n">world</span><span class="p">,</span> <span class="n">state_update</span><span class="p">,</span> <span class="n">fixed_timestep</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        robot : Robot</span>
<span class="sd">            The robot to simulate.</span>

<span class="sd">        world : ndarray or None</span>
<span class="sd">            A 2D numpy array with shape n by 4 with the format [[x1,y1,x2,y2], ... ].</span>
<span class="sd">            Contains the definition of the walls for the simulation.</span>

<span class="sd">        state_update : function</span>
<span class="sd">            The function for the main simulation loop. Gets called up to 60 times a second.</span>

<span class="sd">        kwargs</span>
<span class="sd">            Optional arguments for superclass.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">world</span> <span class="o">=</span> <span class="n">world</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robot</span> <span class="o">=</span> <span class="n">robot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_logic</span> <span class="o">=</span> <span class="n">state_update</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixed_timestep</span> <span class="o">=</span> <span class="n">fixed_timestep</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_timestep</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>

        <span class="c1"># noinspection PyUnusedLocal</span>
        <span class="k">def</span> <span class="nf">_on_keyboard_down</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">scancode</span><span class="p">,</span> <span class="n">codepoint</span><span class="p">,</span> <span class="n">modifiers</span><span class="p">):</span>
            <span class="k">global</span> <span class="n">scale</span>
            <span class="c1"># Pfeiltasten separat behandeln</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">273</span><span class="p">:</span>
                <span class="n">codepoint</span> <span class="o">=</span> <span class="s2">&quot;up&quot;</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">275</span><span class="p">:</span>
                <span class="n">codepoint</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">274</span><span class="p">:</span>
                <span class="n">codepoint</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">276</span><span class="p">:</span>
                <span class="n">codepoint</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>
            <span class="c1"># Sonst:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">codepoint</span>
            <span class="k">if</span> <span class="s2">&quot;0&quot;</span> <span class="o">==</span> <span class="n">codepoint</span><span class="p">:</span>
                <span class="k">global</span> <span class="n">DRAW_LABELS</span>
                <span class="n">DRAW_LABELS</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">DRAW_LABELS</span>
            <span class="k">elif</span> <span class="s2">&quot;+&quot;</span> <span class="o">==</span> <span class="n">codepoint</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_updates_per_frame</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">+=</span> <span class="mf">0.25</span>
            <span class="k">elif</span> <span class="s2">&quot;-&quot;</span> <span class="o">==</span> <span class="n">codepoint</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_updates_per_frame</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">-</span> <span class="mf">0.25</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_updates_per_frame</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updates_per_frame</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;9&quot;</span> <span class="o">==</span> <span class="n">codepoint</span><span class="p">:</span>
                <span class="n">scale</span> <span class="o">+=</span> <span class="mf">0.1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_history</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">elif</span> <span class="s2">&quot;8&quot;</span> <span class="o">==</span> <span class="n">codepoint</span><span class="p">:</span>
                <span class="n">scale</span> <span class="o">-=</span> <span class="mf">0.1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_history</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># noinspection PyUnusedLocal</span>
        <span class="k">def</span> <span class="nf">_on_keyboard_up</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">scancode</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="n">Window</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_key_down</span><span class="o">=</span><span class="n">_on_keyboard_down</span><span class="p">)</span>
        <span class="n">Window</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_key_up</span><span class="o">=</span><span class="n">_on_keyboard_up</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><h2 id="parameters">Parameters</h2>

<p>robot : Robot
    The robot to simulate.</p>

<p>world : ndarray or None
    A 2D numpy array with shape n by 4 with the format [[x1,y1,x2,y2], ... ].
    Contains the definition of the walls for the simulation.</p>

<p>state_update : function
    The function for the main simulation loop. Gets called up to 60 times a second.</p>

<p>kwargs
    Optional arguments for superclass.</p>
</div>


                            </div>
                            <div id="RoboSimPyWidget.on_touch_down" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#RoboSimPyWidget.on_touch_down">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">on_touch_down</span><span class="signature">(self, touch)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">on_touch_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">touch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets called when the user clicks/touches the window of the application.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        touch</span>
<span class="sd">            A touch object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_to_be_added</span> <span class="o">=</span> <span class="n">touch</span><span class="o">.</span><span class="n">pos</span>  <span class="c1"># first point of new line</span>
</pre></div>

        </details>

            <div class="docstring"><p>Gets called when the user clicks/touches the window of the application.</p>

<h2 id="parameters">Parameters</h2>

<p>touch
    A touch object.</p>
</div>


                            </div>
                            <div id="RoboSimPyWidget.on_touch_up" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#RoboSimPyWidget.on_touch_up">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">on_touch_up</span><span class="signature">(self, touch)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">on_touch_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">touch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets called when the user releases a click/touche on the window of the application.</span>
<span class="sd">        This function implements a simple routine to add/remove walls to the active simulation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        touch</span>
<span class="sd">            A touch object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># add new line to world</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">touch</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_be_added</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span>
            <span class="n">touch</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_be_added</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">world</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">*</span><span class="n">touch</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_be_added</span><span class="p">])</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if clicked on line: delete line</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">:]</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_be_added</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
                <span class="n">cross</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span>
                <span class="n">eps</span> <span class="o">=</span> <span class="mf">0.1</span>
                <span class="k">if</span> <span class="o">-</span><span class="n">eps</span> <span class="o">&lt;</span> <span class="n">cross</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">:</span>
                    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">((</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">),</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="n">a</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">world</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="k">break</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_to_be_added</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>

        </details>

            <div class="docstring"><p>Gets called when the user releases a click/touche on the window of the application.
This function implements a simple routine to add/remove walls to the active simulation.</p>

<h2 id="parameters">Parameters</h2>

<p>touch
    A touch object.</p>
</div>


                            </div>
                            <div id="RoboSimPyWidget.update" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#RoboSimPyWidget.update">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">update</span><span class="signature">(self, *args)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Main update routine. Calls the default drawing functions for the robot, robot path history,</span>
<span class="sd">        world, and collision markers as well as the user defined state_update function.</span>
<span class="sd">        Is scheduled to run up to 60 times a second.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot; &quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>  <span class="c1"># Space pauses simulation</span>
            <span class="k">return</span>

        <span class="n">prev_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_logic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_history</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_world</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_collisions</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_robot</span><span class="p">()</span>

        <span class="n">did_collide</span> <span class="o">=</span> <span class="n">collision</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">enclosure</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">did_collide</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_collisions</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">prev_state</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_timestep</span><span class="p">:</span>
            <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
            <span class="n">diff_in_s</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_time</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-9</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_time</span> <span class="o">=</span> <span class="n">current_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">diff_in_s</span>
</pre></div>

        </details>

            <div class="docstring"><p>Main update routine. Calls the default drawing functions for the robot, robot path history,
world, and collision markers as well as the user defined state_update function.
Is scheduled to run up to 60 times a second.</p>
</div>


                            </div>
                            <div id="RoboSimPyWidget.draw_line" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#RoboSimPyWidget.draw_line">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">draw_line</span><span class="signature">(self, x0, y0, x1, y1, pointsize=10, color=(0.0, 0.0, 0.0, 1.0))</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">draw_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">pointsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">:</span>
            <span class="n">Color</span><span class="p">(</span><span class="o">*</span><span class="n">color</span><span class="p">)</span>
            <span class="n">Line</span><span class="p">(</span>
                <span class="n">points</span><span class="o">=</span><span class="p">[</span><span class="n">x0</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">y0</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">y1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">],</span>
                <span class="n">width</span><span class="o">=</span><span class="n">pointsize</span> <span class="o">/</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
                <span class="n">cap</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="p">)</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="RoboSimPyWidget.draw_point" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#RoboSimPyWidget.draw_point">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">draw_point</span><span class="signature">(self, x, y, pointsize, color=(0.0, 0.0, 0.0, 1.0))</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">draw_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">pointsize</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">:</span>
            <span class="n">Color</span><span class="p">(</span><span class="o">*</span><span class="n">color</span><span class="p">)</span>
            <span class="n">ptsize</span> <span class="o">=</span> <span class="n">pointsize</span> <span class="o">*</span> <span class="n">ui_scale</span>
            <span class="n">Ellipse</span><span class="p">(</span>
                <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">-</span> <span class="n">ptsize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">-</span> <span class="n">ptsize</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">ptsize</span><span class="p">,</span> <span class="n">ptsize</span><span class="p">),</span>
            <span class="p">)</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="RoboSimPyWidget.draw_discrete_belief" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#RoboSimPyWidget.draw_discrete_belief">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">draw_discrete_belief</span><span class="signature">(self, belief, grid_size, world_size, max_alpha=1.0)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">draw_discrete_belief</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">belief</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">,</span> <span class="n">world_size</span><span class="p">,</span> <span class="n">max_alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draws a grid based discrete probability distribution over a robot pose (that is 2D position and 1D orientation).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        belief: ndarray</span>
<span class="sd">            3D array with entries describing the probability of the robot being in this cell.</span>
<span class="sd">        grid_size: array</span>
<span class="sd">            3x1 vector describing the size of the belief grid.</span>
<span class="sd">            Entry 1: number of cells in x-direction.</span>
<span class="sd">            Entry 2: number of cells in y-direction.</span>
<span class="sd">            Entry 3: number of cells for possible angular range.</span>
<span class="sd">        world_size: array</span>
<span class="sd">            3x1 vector specifying the world size.</span>
<span class="sd">            Eintrag 1: size in x-direction.</span>
<span class="sd">            Eintrag 2: size in y-direction.</span>
<span class="sd">            Eintrag 3: size of angular range (in rad, if unrestricted: 2*np.pi)</span>
<span class="sd">        max_alpha:</span>
<span class="sd">            Maximum value of alpha channel for display, default is 1.0 (no opacity).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">texture</span> <span class="o">=</span> <span class="n">Texture</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">size</span><span class="o">=</span><span class="n">grid_size</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">colorfmt</span><span class="o">=</span><span class="s2">&quot;rgba&quot;</span><span class="p">,</span>
            <span class="n">icolorfmt</span><span class="o">=</span><span class="s2">&quot;rgba&quot;</span><span class="p">,</span>
            <span class="n">bufferfmt</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
            <span class="n">mipmap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">texture</span><span class="o">.</span><span class="n">mag_filter</span> <span class="o">=</span> <span class="s2">&quot;nearest&quot;</span>

        <span class="n">bel_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">belief</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="c1"># Calculate RGB value from HSV color space</span>
        <span class="n">angle_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">belief</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">vec_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_space</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_space</span><span class="p">)],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">avg_vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">belief</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">vec_space</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">avg_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">avg_vecs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">avg_vecs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">avg_angles</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">360.0</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>  <span class="c1"># max_alpha*bel_sum</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

        <span class="n">hi</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span> <span class="o">//</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">h</span> <span class="o">/</span> <span class="mf">60.0</span> <span class="o">-</span> <span class="n">hi</span>
        <span class="n">p</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">s</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">s</span> <span class="o">*</span> <span class="n">f</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">s</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">f</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">v</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">color</span><span class="p">[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">q</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">color</span><span class="p">[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">t</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">color</span><span class="p">[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">v</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">color</span><span class="p">[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">4</span><span class="p">]</span>
        <span class="n">color</span><span class="p">[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="n">hi</span> <span class="o">==</span> <span class="mi">5</span><span class="p">]</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">bel_sum</span> <span class="o">*</span> <span class="n">max_alpha</span>

        <span class="n">rgba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">texture</span><span class="o">.</span><span class="n">blit_buffer</span><span class="p">(</span><span class="n">rgba</span><span class="o">.</span><span class="n">tobytes</span><span class="p">(),</span> <span class="n">colorfmt</span><span class="o">=</span><span class="s2">&quot;rgba&quot;</span><span class="p">,</span> <span class="n">bufferfmt</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">:</span>
            <span class="n">Color</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">world_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">world_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>
            <span class="n">Rectangle</span><span class="p">(</span><span class="n">texture</span><span class="o">=</span><span class="n">texture</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Draws a grid based discrete probability distribution over a robot pose (that is 2D position and 1D orientation).</p>

<h2 id="parameters">Parameters</h2>

<p>belief: ndarray
    3D array with entries describing the probability of the robot being in this cell.
grid_size: array
    3x1 vector describing the size of the belief grid.
    Entry 1: number of cells in x-direction.
    Entry 2: number of cells in y-direction.
    Entry 3: number of cells for possible angular range.
world_size: array
    3x1 vector specifying the world size.
    Eintrag 1: size in x-direction.
    Eintrag 2: size in y-direction.
    Eintrag 3: size of angular range (in rad, if unrestricted: 2*np.pi)
max_alpha:
    Maximum value of alpha channel for display, default is 1.0 (no opacity).</p>
</div>


                            </div>
                            <div id="RoboSimPyWidget.draw_particles" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#RoboSimPyWidget.draw_particles">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">draw_particles</span><span class="signature">(self, particles, pointsize=10, color=(0.0, 0.0, 0.0, 1.0))</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">draw_particles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">particles</span><span class="p">,</span> <span class="n">pointsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draws particles as a simple way to display a position and orientation, for example</span>
<span class="sd">        for Monte Carlo localization.</span>
<span class="sd">        The first argument &quot;particles&quot; may be a Nx2 or Nx3 array (with N := number of particles).</span>
<span class="sd">        The optional third entry in the second dimension gets interpreted as orientation and is displayed</span>
<span class="sd">        via a small line.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        particles : ndarray</span>
<span class="sd">            2D numpy array with the following structure:</span>
<span class="sd">            [[ x1, y1],</span>
<span class="sd">             [ x2, y2],</span>
<span class="sd">             ...</span>
<span class="sd">            ]</span>
<span class="sd">            OR</span>
<span class="sd">            3D numpy array with the following structure:</span>
<span class="sd">            [[ x1, y1, theta1],</span>
<span class="sd">             [ x2, y2, theta2],</span>
<span class="sd">             ...</span>
<span class="sd">            ]</span>
<span class="sd">        pointsize : int or None</span>
<span class="sd">            Size of the points drawn.</span>
<span class="sd">        color : tuple</span>
<span class="sd">            RGB or RGBA tuple.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">particles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">particles</span><span class="p">])</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">particles</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="p">):</span>  <span class="c1"># [[x1,y1],[x2,y2], ... ] or [x,y]</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">particles</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">draw_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">pointsize</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
                <span class="c1"># Point(points=(scale * particles.flatten()).tolist(), pointsize=pointsize)</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">particles</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">particles</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span>
        <span class="p">):</span>  <span class="c1"># [[x1,y1,theta1],[x2,y2, theta2], ... ] or [x,y, theta]</span>
            
            <span class="k">for</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">particles</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">draw_point</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">pointsize</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">pointsize</span> <span class="o">*</span> <span class="mf">0.03</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">pointsize</span> <span class="o">*</span> <span class="mf">0.03</span>
                <span class="n">Line</span><span class="p">(</span>
                    <span class="n">points</span><span class="o">=</span><span class="p">[</span><span class="n">x0</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">y0</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">y1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">],</span>
                    <span class="n">width</span><span class="o">=</span><span class="n">pointsize</span> <span class="o">/</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
                    <span class="n">cap</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="c1"># Point(points=(scale * particles[:, :2].flatten()).tolist(), pointsize=pointsize)</span>
                <span class="c1"># for i in range(particles.shape[0]):</span>
                <span class="c1">#    p = particles[i, :2]</span>
                <span class="c1">#    t = particles[i, 2]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Wrong dimensions for drawing particles&quot;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Draws particles as a simple way to display a position and orientation, for example
for Monte Carlo localization.
The first argument "particles" may be a Nx2 or Nx3 array (with N := number of particles).
The optional third entry in the second dimension gets interpreted as orientation and is displayed
via a small line.</p>

<h2 id="parameters">Parameters</h2>

<p>particles : ndarray
    2D numpy array with the following structure:
    [[ x1, y1],
     [ x2, y2],
     ...
    ]
    OR
    3D numpy array with the following structure:
    [[ x1, y1, theta1],
     [ x2, y2, theta2],
     ...
    ]
pointsize : int or None
    Size of the points drawn.
color : tuple
    RGB or RGBA tuple.</p>
</div>


                            </div>
                            <div id="RoboSimPyWidget.draw_error_ellipse" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#RoboSimPyWidget.draw_error_ellipse">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">draw_error_ellipse</span><span class="signature">(self, c_p, pos)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">draw_error_ellipse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c_p</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draws a 3x3 covariance matrix C_p at the position pos by projecting into 2D space.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        c_p: ndarray</span>
<span class="sd">            Matrix to draw.</span>
<span class="sd">        pos: ndarray</span>
<span class="sd">            Center of the ellipse.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Src: https://scipython.com/book/chapter-7-matplotlib/examples/bmi-data-with-confidence-ellipses/</span>
        <span class="n">cov</span> <span class="o">=</span> <span class="n">c_p</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">eigvals</span><span class="p">,</span> <span class="n">eigvecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">eigvals</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">eigvals</span><span class="p">,</span> <span class="n">eigvecs</span> <span class="o">=</span> <span class="n">eigvals</span><span class="p">[</span><span class="n">order</span><span class="p">],</span> <span class="n">eigvecs</span><span class="p">[:,</span> <span class="n">order</span><span class="p">]</span>

        <span class="c1"># The anti-clockwise angle to rotate our ellipse by</span>
        <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span> <span class="o">=</span> <span class="n">eigvecs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">eigvecs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">vy</span><span class="p">,</span> <span class="n">vx</span><span class="p">)</span>

        <span class="c1"># Width and height of ellipse to draw</span>
        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eigvals</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">:</span>
            <span class="n">Color</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">PushMatrix</span><span class="p">()</span>
            <span class="n">Rotate</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">origin</span><span class="o">=</span><span class="n">scale</span> <span class="o">*</span> <span class="n">pos</span><span class="p">)</span>
            <span class="n">Line</span><span class="p">(</span>
                <span class="n">ellipse</span><span class="o">=</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">height</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
                    <span class="n">width</span><span class="p">,</span>
                    <span class="n">height</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">width</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">PopMatrix</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Draws a 3x3 covariance matrix C_p at the position pos by projecting into 2D space.</p>

<h2 id="parameters">Parameters</h2>

<p>c_p: ndarray
    Matrix to draw.
pos: ndarray
    Center of the ellipse.</p>
</div>


                            </div>
                            <div id="RoboSimPyWidget.draw_lasers" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#RoboSimPyWidget.draw_lasers">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">draw_lasers</span><span class="signature">(self, robot_state, hitpoints, color=(0.0, 0.4, 0.9))</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">draw_lasers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot_state</span><span class="p">,</span> <span class="n">hitpoints</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draws laser beams.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        robot_state : ndarray</span>
<span class="sd">            Pose (position and orientation) of the robot. This is the origin of the laser beams.</span>
<span class="sd">        hitpoints : ndarray</span>
<span class="sd">            Positions of intersections of laser beams with walls. May contain as many hitpoints as there are laser beams.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">:</span>
            <span class="n">Color</span><span class="p">(</span><span class="o">*</span><span class="n">color</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">hitpoints</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">p</span><span class="p">)):</span>
                    <span class="n">Line</span><span class="p">(</span>
                        <span class="n">points</span><span class="o">=</span><span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">*</span><span class="n">robot_state</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="o">*</span><span class="n">p</span><span class="p">]))</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                        <span class="n">width</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="n">DRAW_LABELS</span><span class="p">:</span>
                <span class="n">Color</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">hitpoints</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">p</span><span class="p">)):</span>
                        <span class="n">lbl_pos</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span> <span class="o">-</span> <span class="mi">8</span><span class="p">)</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">robot_state</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">lbl_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">distance</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="n">lbl_size</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lbl_text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span>
                            <span class="k">else</span> <span class="p">(</span><span class="mi">15</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">)</span>
                        <span class="p">)</span>

                        <span class="n">core_l</span> <span class="o">=</span> <span class="n">CoreLabel</span><span class="p">()</span>
                        <span class="n">core_l</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;font_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span> <span class="o">*</span> <span class="n">ui_scale</span>
                        <span class="n">core_l</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">lbl_text</span>
                        <span class="n">core_l</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
                        <span class="n">Rectangle</span><span class="p">(</span><span class="n">texture</span><span class="o">=</span><span class="n">core_l</span><span class="o">.</span><span class="n">texture</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">lbl_pos</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">lbl_size</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Draws laser beams.</p>

<h2 id="parameters">Parameters</h2>

<p>robot_state : ndarray
    Pose (position and orientation) of the robot. This is the origin of the laser beams.
hitpoints : ndarray
    Positions of intersections of laser beams with walls. May contain as many hitpoints as there are laser beams.</p>
</div>


                            </div>
                            <div id="RoboSimPyWidget.draw_robot" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#RoboSimPyWidget.draw_robot">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">draw_robot</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">draw_robot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draws the robot, that is the hull, the wheels, the connecting lines between the</span>
<span class="sd">        center of the robot coordinate system and each wheel and the center of the robot coordinate</span>
<span class="sd">        system as a green dot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">robot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_point</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="ow">in</span> <span class="n">robot</span><span class="o">.</span><span class="n">enclosure</span><span class="p">:</span>
            <span class="n">Color</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
            <span class="n">Line</span><span class="p">(</span>
                <span class="n">points</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">scale</span>
                    <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="p">(</span>
                                <span class="n">robot</span><span class="o">.</span><span class="n">pos</span>
                                <span class="o">+</span> <span class="n">rotate</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">))</span>
                            <span class="p">),</span>
                            <span class="p">(</span>
                                <span class="n">robot</span><span class="o">.</span><span class="n">pos</span>
                                <span class="o">+</span> <span class="n">rotate</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">))</span>
                            <span class="p">),</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">1.2</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">wheel</span> <span class="ow">in</span> <span class="n">robot</span><span class="o">.</span><span class="n">wheels</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">walpha</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wheel</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
            <span class="n">wbeta</span> <span class="o">=</span> <span class="n">wheel</span><span class="o">.</span><span class="n">beta</span>

            <span class="c1"># line l</span>
            <span class="n">Color</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
            <span class="p">[</span><span class="n">lx1</span><span class="p">,</span> <span class="n">ly1</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span>
                <span class="n">walpha</span> <span class="o">+</span> <span class="n">robot</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wheel</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">rlx</span><span class="p">,</span> <span class="n">rly</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lx1</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ly1</span>
            <span class="n">Line</span><span class="p">(</span>
                <span class="n">points</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">robot</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rlx</span><span class="p">,</span> <span class="n">rly</span><span class="p">])</span>
                <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">width</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># line d</span>
            <span class="n">Color</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="p">[</span><span class="n">dx2</span><span class="p">,</span> <span class="n">dy2</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span>
                <span class="n">walpha</span> <span class="o">+</span> <span class="n">wbeta</span> <span class="o">+</span> <span class="n">robot</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wheel</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">rldx</span><span class="p">,</span> <span class="n">rldy</span> <span class="o">=</span> <span class="n">rlx</span> <span class="o">+</span> <span class="n">dx2</span><span class="p">,</span> <span class="n">rly</span> <span class="o">+</span> <span class="n">dy2</span>
            <span class="n">Line</span><span class="p">(</span>
                <span class="n">points</span><span class="o">=</span><span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rlx</span><span class="p">,</span> <span class="n">rly</span><span class="p">,</span> <span class="n">rldx</span><span class="p">,</span> <span class="n">rldy</span><span class="p">]))</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">width</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># wheel</span>
            <span class="n">Color</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="k">if</span> <span class="n">wheel</span><span class="o">.</span><span class="n">motor</span> <span class="k">else</span> <span class="n">Color</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">)</span>
            <span class="p">[</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span>
                <span class="n">walpha</span> <span class="o">+</span> <span class="n">wbeta</span> <span class="o">+</span> <span class="n">robot</span><span class="o">.</span><span class="n">theta</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">robot</span><span class="o">.</span><span class="n">wheel_radius</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">Line</span><span class="p">(</span>
                <span class="n">points</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rldx</span> <span class="o">+</span> <span class="n">rx</span><span class="p">,</span> <span class="n">rldy</span> <span class="o">+</span> <span class="n">ry</span><span class="p">,</span> <span class="n">rldx</span> <span class="o">-</span> <span class="n">rx</span><span class="p">,</span> <span class="n">rldy</span> <span class="o">-</span> <span class="n">ry</span><span class="p">])</span>
                <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
            <span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_point</span><span class="p">(</span><span class="n">rldx</span> <span class="o">+</span> <span class="n">rx</span><span class="p">,</span> <span class="n">rldy</span> <span class="o">+</span> <span class="n">ry</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">.2</span><span class="p">,</span> <span class="mf">.2</span><span class="p">))</span>
</pre></div>

        </details>

            <div class="docstring"><p>Draws the robot, that is the hull, the wheels, the connecting lines between the
center of the robot coordinate system and each wheel and the center of the robot coordinate
system as a green dot.</p>
</div>


                            </div>
                            <div id="RoboSimPyWidget.draw_world" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#RoboSimPyWidget.draw_world">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">draw_world</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">draw_world</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draws the world as a collection of lines as defined by the world array.&quot;&quot;&quot;</span>
        <span class="n">Color</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">:</span>
            <span class="n">Line</span><span class="p">(</span>
                <span class="n">points</span><span class="o">=</span><span class="p">[</span><span class="n">scale</span> <span class="o">*</span> <span class="n">x1</span><span class="p">,</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">y1</span><span class="p">,</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">x2</span><span class="p">,</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">y2</span><span class="p">],</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">1.2</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">,</span>
            <span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Draws the world as a collection of lines as defined by the world array.</p>
</div>


                            </div>
                            <div id="RoboSimPyWidget.draw_history" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#RoboSimPyWidget.draw_history">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">draw_history</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">draw_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draws the past trajectory of the robot.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">pos</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">MAX_HISTORY</span><span class="p">:</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">Color</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>
        <span class="n">Line</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.2</span> <span class="o">*</span> <span class="n">ui_scale</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Draws the past trajectory of the robot.</p>
</div>


                            </div>
                            <div id="RoboSimPyWidget.draw_collisions" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#RoboSimPyWidget.draw_collisions">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">draw_collisions</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">draw_collisions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets used to mark the current position of a robot during a collision.&quot;&quot;&quot;</span>
        <span class="n">Color</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">Point</span><span class="p">(</span>
            <span class="n">points</span><span class="o">=</span><span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_collisions</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">pointsize</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">ui_scale</span>
        <span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Gets used to mark the current position of a robot during a collision.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>kivy.uix.widget.Widget</dt>
                                <dd id="RoboSimPyWidget.proxy_ref" class="variable">proxy_ref</dd>
                <dd id="RoboSimPyWidget.apply_class_lang_rules" class="function">apply_class_lang_rules</dd>
                <dd id="RoboSimPyWidget.collide_point" class="function">collide_point</dd>
                <dd id="RoboSimPyWidget.collide_widget" class="function">collide_widget</dd>
                <dd id="RoboSimPyWidget.on_touch_move" class="function">on_touch_move</dd>
                <dd id="RoboSimPyWidget.on_kv_post" class="function">on_kv_post</dd>
                <dd id="RoboSimPyWidget.add_widget" class="function">add_widget</dd>
                <dd id="RoboSimPyWidget.remove_widget" class="function">remove_widget</dd>
                <dd id="RoboSimPyWidget.clear_widgets" class="function">clear_widgets</dd>
                <dd id="RoboSimPyWidget.export_to_png" class="function">export_to_png</dd>
                <dd id="RoboSimPyWidget.export_as_image" class="function">export_as_image</dd>
                <dd id="RoboSimPyWidget.get_root_window" class="function">get_root_window</dd>
                <dd id="RoboSimPyWidget.get_parent_window" class="function">get_parent_window</dd>
                <dd id="RoboSimPyWidget.walk" class="function">walk</dd>
                <dd id="RoboSimPyWidget.walk_reverse" class="function">walk_reverse</dd>
                <dd id="RoboSimPyWidget.to_widget" class="function">to_widget</dd>
                <dd id="RoboSimPyWidget.to_window" class="function">to_window</dd>
                <dd id="RoboSimPyWidget.to_parent" class="function">to_parent</dd>
                <dd id="RoboSimPyWidget.to_local" class="function">to_local</dd>
                <dd id="RoboSimPyWidget.get_window_matrix" class="function">get_window_matrix</dd>
                <dd id="RoboSimPyWidget.x" class="variable">x</dd>
                <dd id="RoboSimPyWidget.y" class="variable">y</dd>
                <dd id="RoboSimPyWidget.width" class="variable">width</dd>
                <dd id="RoboSimPyWidget.height" class="variable">height</dd>
                <dd id="RoboSimPyWidget.pos" class="variable">pos</dd>
                <dd id="RoboSimPyWidget.size" class="variable">size</dd>
                <dd id="RoboSimPyWidget.get_right" class="function">get_right</dd>
                <dd id="RoboSimPyWidget.set_right" class="function">set_right</dd>
                <dd id="RoboSimPyWidget.right" class="variable">right</dd>
                <dd id="RoboSimPyWidget.get_top" class="function">get_top</dd>
                <dd id="RoboSimPyWidget.set_top" class="function">set_top</dd>
                <dd id="RoboSimPyWidget.top" class="variable">top</dd>
                <dd id="RoboSimPyWidget.get_center_x" class="function">get_center_x</dd>
                <dd id="RoboSimPyWidget.set_center_x" class="function">set_center_x</dd>
                <dd id="RoboSimPyWidget.center_x" class="variable">center_x</dd>
                <dd id="RoboSimPyWidget.get_center_y" class="function">get_center_y</dd>
                <dd id="RoboSimPyWidget.set_center_y" class="function">set_center_y</dd>
                <dd id="RoboSimPyWidget.center_y" class="variable">center_y</dd>
                <dd id="RoboSimPyWidget.center" class="variable">center</dd>
                <dd id="RoboSimPyWidget.cls" class="variable">cls</dd>
                <dd id="RoboSimPyWidget.children" class="variable">children</dd>
                <dd id="RoboSimPyWidget.parent" class="variable">parent</dd>
                <dd id="RoboSimPyWidget.size_hint_x" class="variable">size_hint_x</dd>
                <dd id="RoboSimPyWidget.size_hint_y" class="variable">size_hint_y</dd>
                <dd id="RoboSimPyWidget.size_hint" class="variable">size_hint</dd>
                <dd id="RoboSimPyWidget.pos_hint" class="variable">pos_hint</dd>
                <dd id="RoboSimPyWidget.size_hint_min_x" class="variable">size_hint_min_x</dd>
                <dd id="RoboSimPyWidget.size_hint_min_y" class="variable">size_hint_min_y</dd>
                <dd id="RoboSimPyWidget.size_hint_min" class="variable">size_hint_min</dd>
                <dd id="RoboSimPyWidget.size_hint_max_x" class="variable">size_hint_max_x</dd>
                <dd id="RoboSimPyWidget.size_hint_max_y" class="variable">size_hint_max_y</dd>
                <dd id="RoboSimPyWidget.size_hint_max" class="variable">size_hint_max</dd>
                <dd id="RoboSimPyWidget.ids" class="variable">ids</dd>
                <dd id="RoboSimPyWidget.opacity" class="variable">opacity</dd>
                <dd id="RoboSimPyWidget.on_opacity" class="function">on_opacity</dd>
                <dd id="RoboSimPyWidget.canvas" class="variable">canvas</dd>
                <dd id="RoboSimPyWidget.get_disabled" class="function">get_disabled</dd>
                <dd id="RoboSimPyWidget.set_disabled" class="function">set_disabled</dd>
                <dd id="RoboSimPyWidget.inc_disabled" class="function">inc_disabled</dd>
                <dd id="RoboSimPyWidget.dec_disabled" class="function">dec_disabled</dd>
                <dd id="RoboSimPyWidget.disabled" class="variable">disabled</dd>

            </div>
            <div><dt>kivy._event.EventDispatcher</dt>
                                <dd id="RoboSimPyWidget.register_event_type" class="function">register_event_type</dd>
                <dd id="RoboSimPyWidget.unregister_event_types" class="function">unregister_event_types</dd>
                <dd id="RoboSimPyWidget.is_event_type" class="function">is_event_type</dd>
                <dd id="RoboSimPyWidget.bind" class="function">bind</dd>
                <dd id="RoboSimPyWidget.unbind" class="function">unbind</dd>
                <dd id="RoboSimPyWidget.fbind" class="function">fbind</dd>
                <dd id="RoboSimPyWidget.funbind" class="function">funbind</dd>
                <dd id="RoboSimPyWidget.unbind_uid" class="function">unbind_uid</dd>
                <dd id="RoboSimPyWidget.get_property_observers" class="function">get_property_observers</dd>
                <dd id="RoboSimPyWidget.events" class="function">events</dd>
                <dd id="RoboSimPyWidget.dispatch" class="function">dispatch</dd>
                <dd id="RoboSimPyWidget.dispatch_generic" class="function">dispatch_generic</dd>
                <dd id="RoboSimPyWidget.dispatch_children" class="function">dispatch_children</dd>
                <dd id="RoboSimPyWidget.setter" class="function">setter</dd>
                <dd id="RoboSimPyWidget.getter" class="function">getter</dd>
                <dd id="RoboSimPyWidget.property" class="function">property</dd>
                <dd id="RoboSimPyWidget.properties" class="function">properties</dd>
                <dd id="RoboSimPyWidget.create_property" class="function">create_property</dd>
                <dd id="RoboSimPyWidget.apply_property" class="function">apply_property</dd>

            </div>
            <div><dt>kivy._event.ObjectWithUid</dt>
                                <dd id="RoboSimPyWidget.uid" class="variable">uid</dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>